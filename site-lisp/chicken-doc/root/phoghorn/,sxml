((tags "egg") (section 2 "phoghorn" (toc) (section 3 "Description" (p "A thumbnail gallery library for " (int-link "spiffy") ".")) (section 3 "Author" (p (int-link "/users/peter-bex" "Peter Bex"))) (section 3 "Requirements" (p "Requires " (int-link "spiffy") ", " (int-link "sxml-transforms") ", " (int-link "uri-common") ", " (int-link "imlib2") " and " (int-link "epeg") ". You will also need to install " (int-link "sxml-fu") " to make use of it.")) (section 3 "Documentation" (p "Phoghorn is a web-based image gallery with built-in automatic thumbnail generator for " (int-link "spiffy") " the webserver.") (p "Its features are:") (ul (li "Easy to use (just drop a bunch of files in a directory underneath the designated photos dir)") (li "Configurable") (li "Does not require a database") (li "Uses CSS for styling, so its look is easily changed") (li "Leverages " (int-link "imlib2") " for maximum image file type support and " (int-link "epeg") " for extra-speedy JPEG handling.") (li "Built with SXML for clean and semantic source markup, with all benefits of a functional programming style."))) (section 3 "Usage" (p "By default, phoghorn assumes there is a directory called " (tt "galleries") " in the directory from which you call its functions (ie, the same directory in which you placed " (tt "index.ws") " or " (tt "index.ssp") "). It will create thumbnails on-the-fly when there aren't any yet, and only for those pictures on the page that is currently being viewed.  By default, these will be placed in the " (tt "thumbs") " directory under the gallery's directory.") (p "In the main page (save this as " (tt "index.ssp") "):") (highlight scheme "(use phoghorn sxml-transforms uri-common sxml-pagination sxml-shortcuts)\n\n(define content\n  `((html\n     (head (title \"Showing gallery: \" ,(current-gallery)))\n     (body\n      (phoghorn-gallery)))))\n\n(define (output-html content . rules)\n  (SRV:send-reply (fold (lambda (ruleset content)\n\t\t\t  (pre-post-order content ruleset)) content rules)))\n\n;; We want bigger pages\n(parameterize ((page-size 40)\n               (base-uri (request-uri (current-request))))\n  (output-html content phoghorn-rules pagination-rules shortcut-rules universal-conversion-rules))") (p "Phoghorn generates output that must be processed by the " (tt "pagination-rules") " and " (tt "shortcut-rules") " from the " (int-link "sxml-fu") " egg, hence the complicated output statement.") (p "In the zoomed-in page (save this as " (tt "zoomed.ssp") "):") (highlight scheme "(use phoghorn sxml-transforms sxml-shortcuts)\n\n(define content\n  `((html\n     (head (title \"Showing photo: \" ,(current-entry-filename))\n     (body\n       (phoghorn-zoomed-entry))))))\n\n(define (output-html content . rules)\n  (SRV:send-reply (fold (lambda (ruleset content)\n\t\t\t  (pre-post-order content ruleset)) content rules)))\n\n;; The shortcut-rules and the pagination-rules are mandatory, by the way\n(output-html content phoghorn-rules shortcut-rules universal-conversion-rules)")) (section 3 "Configuration" (p "Phoghorn can be customised to the max.  The following " (link "http://srfi.schemers.org/srfi-39/" "SRFI-39 parameters") " are supported, in addition to the configuration options for " (int-link "sxml-fu#pagination" "sxml-fu's pagination rules") " (which phoghorn uses internally):") (section 4 "Directory and file settings" (def (sig (parameter "(gallery-dir [directory-name])" (id gallery-dir))) (p "The directory under which the galleries can be found, relative to the index page. Defaults to " (tt "\"galleries\"") ".")) (def (sig (parameter "(gallery-url [url-string])" (id gallery-url))) (p "The page that shows gallery listings with thumbnail entries. Defaults to " (tt "\"index.ssp\""))) (def (sig (parameter "(zoomed-url [url-string])" (id zoomed-url))) (p "The webpage that serves the zoomed-in views on images. Defaults to " (tt "\"zoomed.ssp\"")) (p "<parameter>(thumb-dir [directory-name])") (p "The name of the directory under which thumnail versions of the images in the parent directory are stored. Defaults to " (tt "\"thumbs\"") ".") (pre "\t     "))) (section 4 "Variable control" (def (sig (parameter "(gallery-var [symbol])" (id gallery-var))) (p "The name of the GET parameter that contains the gallery the user wishes to view. Defaults to " (tt "gallery") ".")) (def (sig (parameter "(entry-var [symbol])" (id entry-var))) (p "The name of the GET parameter that contains the entry the user wishes to view (when zoomed). Defaults to " (tt "entry") "."))) (section 4 "Thumbnail generation" (def (sig (parameter "(max-thumb-dimensions [number])" (id max-thumb-dimensions))) (p "Maximum width " (i "or") " height of a thumbnail.") (p "The smaller of the two will get scaled by the same factor as the larger, which will be shrunk into this size. In other words, it maintains the aspect ratio of the original picture in the thumb.") (p "Defaults to " (tt "100") "."))) (section 4 "Presentational options" (def (sig (parameter "(movie-image [url-string])" (id movie-image))) (p "The image file to display when a movie is in the gallery. Defaults to " (tt "\"/pics/movie.jpg\"") ".")) (def (sig (parameter "(root-gallery-name [string])" (id root-gallery-name))) (p "The title of the topmost gallery.  All subgalleries have a title that is equal to the directory name. Defaults to " (tt "\"Galleries\"") ".")))) (section 3 "Procedures" (p "You can use these procedures if you want more control over the way your gallery is output, ie using it more as a library than as a complete thumbnail gallery package.") (def (sig (procedure "(gallery-contents)" (id gallery-contents))) (p "Get the contents of the currently selected gallery (as determined by " (tt "gallery-var") ").") (p "Returns two values: The first value is a list of subgalleries in that gallery, the second value is a list of entries (ie, pictures) in that gallery.")) (def (sig (procedure "(thumbnail gallery entry)" (id thumbnail))) (p "Returns a link to the thumbnail picture of the selected entry under the selected gallery.") (p "Chooses " (tt "thumbnail/epeg") " or " (tt "thumbnail/imlib2") " based on the entry file.") (p "Side-effects: creates the thumbnail if it does not exist and creates the thumbs directory as determined by " (tt "thumb-dir") " if necessary.")) (def (sig (procedure "(thumbnail/epeg gallery entry)" (id thumbnail/epeg))) (p "Epeg-specific version of " (tt "thumbnail") ". " (b "Note: the source image must be a jpeg."))) (def (sig (procedure "(thumbnail/imlib2 gallery entry)" (id thumbnail/imlib2))) (p "Imlib2-specific version of " (tt "thumbnail") ".") (p (b "Note: the source image must be of a type understood by imlib2."))) (def (sig (procedure "(galleries-up-to gallery)" (id galleries-up-to))) (p "Returns a list of all the galleries from the root gallery up to the specified gallery.")) (def (sig (procedure "(prev-entry entry entries)" (id prev-entry))) (p "Return the filename of the previous entry in the " (tt "entries") " list, as seen from the selected entry.  Returns " (tt "#f") " if this is the first entry in the list.")) (def (sig (procedure "(next-entry entry entries)" (id next-entry))) (p "Return the filename of the next entry in the " (tt "entries") " list, as seen from the selected entry.  Returns " (tt "#f") " if this is the last entry in the list."))) (section 3 "Tags" (p "This section describes the SXML tags that are available when you use " (tt "phoghorn-rules") ".  You can override the default phoghorn transformation rules for these tags, or generate these tags yourself and have phoghorn transform them for you.") (pre "  [tag] (phoghorn-gallery)") (p "Output the current gallery, including links to its subgalleries (if any) and entry thumbnails (if any).  Also shows breadcrumb links.") (pre "  [tag] (gallery-entries entries)") (p "Shows an unordered list of the paginated " (tt "entries") ", headed by a pagination list.") (pre "  [tag] (gallery-list galleries)") (p "Shows an unordered list of (sub) galleries.") (pre "  [tag] (gallery-link gallery)") (p "Generates a link to the given gallery.  If " (tt "gallery") " is " (tt "#f") " , a link to the root gallery with " (tt "(root-gallery-name)") " \" as the link title is generated.") (pre "  [tag] (gallery-entry gallery entry)") (p "Generates a link to the zoomed version of " (tt "entry") " with the (generated if necessary) thumbnail.") (pre "  [tag] (zoomed-url gallery entry)") (p "Generates a link to " (tt "zoomed-url") " with the gallery and entry as parameters. (using " (tt "link-to") ").") (pre "  [tag] (phoghorn-breadcrumbs gallery)") (p "Generate " (link "http://developer.yahoo.com/ypatterns/pattern.php?pattern=breadcrumbs" "breadcrumb") " links from the root gallery up to the selected gallery.") (pre "  [tag] (phoghorn-zoomed-entry)") (p "Show the currently zoomed entry picture full-size.  Includes navigation to the next and previous entry and breadcrumbs.") (pre "  [tag] (entry-navigation)") (p "Generate navigation to the next and previous entry link in the current gallery, relative to the currently selected entry as determined from " (tt "gallery-var") " and " (tt "entry-var") ".") (pre "  [tag] (zoomed-picture gallery entry)") (p "The zoomed entry picture in the selected gallery.")) (section 3 "Changelog" (ul (li "2.3 Port to Chicken 4 and Spiffy 4.") (li "2.2 Update to new version of Spiffy - (current-workdir) now means something else so phoghorn >= 2.2 _does not work_ with Spiffy < 3.9") (li "2.1 Update to new version of spiffy-utils.") (li "2.0 Complete rewrite in SXML.") (li "1.2 Update to latest versions of epeg and imlib2.") (li "1.1.1 Changed .setup script to reflect new distribution of syntax-case.") (li "1.1 Fix small bug (a let statement was closed a little too early.") (li "1.0 initial release."))) (section 3 "License" (pre " Copyright (c) 2005-2009, Peter Bex\n All rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n Redistributions in binary form must reproduce the above copyright\n notice, this list of conditions and the following disclaimer in the\n documentation and/or other materials provided with the distribution.\n \n Neither the name of the author nor the names of its contributors may\n be used to endorse or promote products derived from this software\n without specific prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS\n FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE\n COPYRIGHT HOLDERS OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,\n STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n OF THE POSSIBILITY OF SUCH DAMAGE."))))