((section 2 "Awful" (toc) (section 3 "Description" (p "awful provides an application and an extension to ease the development of web-based applications.") (p "Here's a short summary of awful features:") (ul (li "Straightforward interface to databases (currently supported are postgresql and sqlite3)") (li "Support for page dispatching via regular expressions") (li "Easy access to query string and body request variables from HTTP requests") (li "Ajax support via " (link "http://jquery.com/" "JQuery")) (li "Reasonably flexible (several configuration parameters)") (li "Compiled pages made easy") (li "Session inspector") (li "Web REPL")) (section 4 "Screencasts" (p "Here are some screencasts about awful:") (dl (dt (link "http://wiki.call-cc.org/video/awful.ogv" "Awful in 35s")) (dd "a 35 seconds video showing the installation of the awful egg and the development of a \"hello, world\" example") (dt (link "http://wiki.call-cc.org/video/awful-guess.ogv" "Number guessing game")) (dd "a video demonstrating the development of a very simple number guessing game using ajax and the web REPL")))) (section 3 "Author" (p (int-link "/users/mario-domenech-goulart" "Mario Domenech Goulart"))) (section 3 "Requirements" (p "The following eggs are required:") (ul (li (int-link "/egg/spiffy" "spiffy")) (li (int-link "/egg/spiffy-cookies" "spiffy-cookies")) (li (int-link "/egg/spiffy-request-vars" "spiffy-request-vars")) (li (int-link "/egg/html-tags" "html-tags")) (li (int-link "/egg/html-utils" "html-utils")) (li (int-link "/egg/json" "json")) (li (int-link "/egg/http-session" "http-session")))) (section 3 "Components" (p "awful is composed by two parts: an application, which can be thought as a web server; and an extension, which provides most of the supported features.")) (section 3 "A \"Hello, world!\" example" (p "Here's a \"Hello, world!\" example to be run by awful (" (tt "hello-world.scm") ").") (highlight scheme "(use awful)\n\n(define-page (main-page-path)\n  (lambda ()\n    \"Hello, world!\"))") (p "To run this example, execute:") (pre " $ awful hello-world.scm") (p "Then access localhost:8080 using your favourite web browser.") (p "Without any configuration, awful listens on port 8080.  Since awful uses Spiffy behind the scenes, you can configure the web server parameters using Spiffy's.") (p (tt "define-page") " is the primitive procedure to define pages.  In the simplest case, it takes as arguments a path to the page and a procedure to generate the page contents. The path to the page you use as the first argument is the same to be used as the path part of the URL you use to access the page.") (p "In the example we use the " (tt "main-page-path") " parameter, which is one of the awful configuration parameters.  The default is " (tt "\"/\"") ".") (p "If you look at the page source code, you'll see that awful created an HTML page for you.  Awful uses the " (int-link "/egg/html-utils" "html-tags") "'s " (tt "html-page") " procedure behind the scenes.  You can customize the page either by passing " (tt "html-page") "'s keyword parameters to " (tt "define-page") " or by setting the " (tt "page-template") " parameter with your favourite procedure to generate pages. " (tt "page-template") " is a one-mandatory-argument procedure which receives the page contents and returns a string representing the formatted contents. " (tt "define-page") " would still pass the " (tt "html-page") " keyword parameters, so you can make use of them (the " (tt "page-template") " procedure should be defined considering them -- if you don't need them, just ignore them by defining " (tt "(lambda (contents . args) ...)") ").") (p "You can also use some global page-related parameters if all pages use the same CSS, doctype and charset (" (tt "page-css") ", " (tt "page-doctype") " and " (tt "page-charset") ", respectively).") (p "An alternative way to write Awful " (b "scripts") " is by using the " (tt "#!/path/to/awful") " shebang line.  Example:") (highlight scheme "#! /usr/bin/awful\n\n(use awful)\n\n(define-page (main-page-path)\n  (lambda ()\n    \"Hello, world!\"))") (p "Then you just need to run your script (assuming the file has execution permissions):") (pre " $ ./hello-world.scm")) (section 3 "Accessing request variables" (p "Awful provides a procedure (" (tt "$") ") to access variables from the request, both from the query string (GET method) and from the request body (e.g., POST method).") (p "Here's a modified \"Hello, world!\" example to greet some person instead of the whole world:") (highlight scheme "(use awful)\n\n(define-page (main-page-path)\n  (lambda ()\n    (++ \"Hello, \" ($ 'person \"world\") \"!\")))") (p "The " (tt "++") " procedure is an alias to " (tt "string-append") " (name inspired by Haskell's operator to concatenate strings).") (p "So, restart the web server to reload the code, then access the main page using an argument, represented by the " (tt "person") " query string variable: " (tt "http://localhost:8080/?person=Mario") ". You'll see a page showing " (tt "Hello, Mario!") ".")) (section 3 "Re-evaluating the code by reloading the page" (p "When we upgraded our \"Hello, world!\" example to the improved one which can use an argument passed through the URL, we needed to modify the code and restart the web server to reload the application code.  Awful provides a way to reload the code via URL without restarting the server.  To do that, we can define a special page whose handler just reloads the code:") (highlight scheme "(define-page \"/reload\"\n  (lambda ()\n    (load-apps (awful-apps))\n    \"Reloaded\"))") (p "and restart the awful server.  Now, whenever you want to reload the application code, access " (tt "http://localhost:8080/reload") ".") (p "You can control which IP numbers can access the reload page by using the " (tt "page-access-control") " parameter.  For example, allowing only the localhost to reload the apps:") (highlight scheme "(page-access-control\n (lambda (path)\n   (if (equal? path \"/reload\")\n       (member (remote-address) '(\"127.0.0.1\"))\n       #t)))") (p "When used in development mode (see the " (tt "--development-mode") " command line option for the awful application server), awful automatically defines a " (tt "/reload") " path (available to any host) for reloading all the applications.")) (section 3 "Using ajax" (p "Awful provides a way to (hopefully) make the use of ajax straightforward for web applications.") (p "By default, the ajax support is disabled, but it can be easily globally enabled by setting the " (tt "enable-ajax") " parameter to " (tt "#t") ".  When you enable ajax via " (tt "enable-ajax") ", all the pages defined via " (tt "define-page") " will be linked to the JQuery javascript library. If you want just a couple of pages to have ajax support (i.e., not global ajax support), you can use the " (tt "use-ajax") " keyword parameter for " (tt "define-page") ", so only the pages defined with " (tt "use-ajax: #t") " have ajax support.") (p "When you have ajax enabled and you want to disable it for specific pages, you can pass " (tt "#f") " as the value for the " (tt "define-page") " keyword parameter " (tt "no-ajax") ".") (p "The URL of the JQuery file can be customized by setting the " (tt "ajax-library") " parameter (the default is Google's API JQuery file version 1.4.2).") (p "So, if we now change our code to") (highlight scheme "(use awful)\n\n(define-page (main-page-path)\n  (lambda ()\n    (++ \"Hello, \" ($ 'person \"world\") \"!\"))\n  use-ajax: #t)") (p "and reload the application, we'll have our page linked to JQuery.") (p "Awful provides some procedures to do ajax.  We start by the more generic one (" (tt "ajax") ") to reply the page greetings when we click \"Hello, <person>!\".") (highlight scheme "(use awful html-tags)\n\n(define-page (main-page-path)\n  (lambda ()\n    (ajax \"greetings\" 'greetings 'click\n          (lambda ()\n            (<b> \"Hello, awful!\"))\n          target: \"greetings-reply\")\n    (++ (<a> href: \"#\"\n             id: \"greetings\"\n             (++ \"Hello, \" ($ 'person \"world\") \"!\"))\n        (<div> id: \"greetings-reply\")))\n  use-ajax: #t)") (p "The " (tt "ajax") " procedure uses at least four arguments:") (p "1. The URL path to the server-side handler (a string).  This path is relative to " (tt "ajax-namespace") " parameter (default is " (tt "ajax") ".  So, in the example, we'll have " (tt "/ajax/greetings") " as the ajax path to be generated if we pass " (tt "ajax") " as the first argument.") (p "2. The ID of the DOM element to observe.") (p "3. The event to be handled") (p "4. The procedure to be run on the server-side.") (p "So, in the example, " (tt "ajax") " will bind the fourth argument (the procedure) to the first argument (the path) on the server side. Then it will add javascript code to the page in order to wait for click events for the element of ID " (tt "greetings") ".  When we click \"Hello, <person>!\", we'll get " (tt "Hello, awful!") " printed on the page as reply.  " (tt "ajax") " updates the DOM element whose id is the value of the " (tt "target") " keyword parameter (" (tt "\"greetings-reply\"") ", in the example).") (p "For the very specific case of creating links that execute server side code when clicked, awful provides the " (tt "ajax-link") " procedure.  So our example could be coded like:") (highlight scheme "(use awful)\n\n(define-page (main-page-path)\n  (lambda ()\n    (++ (ajax-link \"greetings\" 'greetings\n                   (lambda ()\n                     (<b> \"Hello, awful!\"))\n                   target: \"greetings-reply\")\n        (<div> id: \"greetings-reply\")))\n  use-ajax: #t)")) (section 3 "Adding arbitrary javascript code to pages" (p "Awful provides a procedure which can be used to add arbitrary javascript code to the page. It's called " (tt "add-javascript") ".  Here's an example using javascript's " (tt "alert") " and our \"Hello, world!\" example:") (highlight scheme "(use awful)\n\n(define-page (main-page-path)\n  (lambda ()\n    (add-javascript \"alert('Hello!');\")\n    (++ (ajax-link \"greetings\" 'greetings\n                   (lambda ()\n                     (<b> \"Hello, awful!\"))\n                   target: \"greetings-reply\")\n        (<div> id: \"greetings-reply\")))\n  use-ajax: #t)")) (section 3 "Database access" (p "To access databases, you need some of the awful eggs which provide database access.  Currently, these are the possible options:") (ul (li (int-link "/egg/awful-postgresql" "awful-postgresql") " (for Postgresql databases, using the " (int-link "/egg/postgresql" "postgresql") " egg)") (li (int-link "/egg/awful-sqlite3" "awful-sqlite3") " (for Sqlite3 databases, using the " (int-link "/egg/sqlite3" "sqlite3") " egg)") (li (int-link "/egg/awful-sql-de-lite" "awful-sql-de-lite") " (for Sqlite3 databases, using the " (int-link "/egg/sql-de-lite" "sql-de-lite") " egg)")) (p "As with ajax, database access is not enabled by default.  To enable it, you need to pick one the awful database support eggs and call the " (tt "enable-db") " procedure.  Since version 0.10, and differently from the " (tt "enable-*") " parameters, " (tt "enable-db") " is a zero-argument procedure provided by each of awful database-support eggs.  So, if you use " (tt "awful-postgresql") ", the " (tt "enable-db") " procedure will automatically set up awful to use a postgresql database.") (p "Additionally, to access the db, you need to provide the credentials.  You can provide the credentials by setting the " (tt "db-credentials") " parameter.  See the documentation for the eggs corresponding to the database type you are using (" (int-link "/egg/postgresql" "postgresql") " for Postgresql and " (int-link "/egg/sqlite3" "sqlite3") " or " (int-link "/egg/sql-de-lite" "sql-de-lite") " for Sqlite3.)") (p "To actually query the database, there's the " (tt "$db") " procedure, which uses as arguments a string representing the query and, optionally, a default value (a keyword parameter) to be used in case the query doesn't return any result. " (tt "$db") " returns a list of lists. Below is an usage example:") (highlight scheme "(use awful awful-postgresql)\n\n(enable-db)\n(db-credentials '((dbname . \"my-db\")\n                  (user . \"mario\")\n                  (password . \"secret\")\n                  (host . \"localhost\")))\n\n(define-page \"db-example\"\n  (lambda ()\n    (with-output-to-string\n      (lambda ()\n        (pp ($db \"select full_name, phone from users\"))))))") (p (i "Hint") ": for Sqlite3 databases, " (tt "db-credentials") " should be the path to the database file.") (p "There's also the " (tt "$db-row-obj") " procedure for when you want to access the results of a query by row name.  " (tt "$db-row-obj") " returns a procedure of two arguments: the name of the field and, optionally, a default value to be used in case the field value is " (tt "#f") ".") (highlight scheme "(define-page \"db-example\"\n  (lambda ()\n    (let ((& ($db-row-obj \"select full_name, phone from users where user_id=1\")))\n      (<p> \"Full name: \" (& 'full_name))\n      (<p> \"Phone: \" (& 'phone)))))") (p (i "Warning") ": currently " (tt "$db-row-obj") " is only implemented for Postgresql.") (p "If you need more flexibility to query the database, you can always use the " (tt "(db-connection") ") parameter to get the database connection object and use it with the procedures available from the your favorite database egg API.")) (section 3 "Login pages and session" (p "Awful provides a very basic (awful?) support for creating authentication pages.") (p "The basic things you have to do is:") (p "1. Enable the use of sessions:") (highlight scheme "(enable-session #t)") (p "2. Set the password validation parameter.  This parameter is a two argument procedure (user and password) which returns a value (usually " (tt "#t") " or " (tt "#f") ") indicating whether the password is valid for the given user.  The default is a password which returns " (tt "#f") ".  Let's set it to a procedure which returns " (tt "#t") " is the user and the password are the same:") (highlight scheme "(valid-password?\n  (lambda (user password)\n    (equal? user password)))") (p "3. Define a login trampoline, which is an intermediate page accessed when redirecting from the login page to the main page.") (highlight scheme "(define-login-trampoline \"/login-trampoline\")") (p "4. Create a login page.  Awful provides a simple user/password login form (" (tt "login-form") "), which we are going to use.  Here's our full example so far (using the basic \"Hello, world!\" as main page).") (highlight scheme "(use awful)\n\n(enable-session #t)\n\n(define-login-trampoline \"/login-trampoline\")\n\n(valid-password?\n  (lambda (user password)\n    (equal? user password)))\n\n(define-page (main-page-path)\n  (lambda ()\n    \"Hello world!\"))\n\n(define-page (login-page-path)\n  (lambda ()\n    (login-form))\n  no-session: #t)") (p "That's the very basic we need to set an auth page.  If the password is valid for the given user, awful will perform a redirect to the main page (" (tt "main-page-path") " parameter) passing the " (tt "user") " variable and its value in the query string .  If the password is not valid, awful will redirect to the login page (" (tt "login-page-path") " parameter) and pass the following variables and values:") (dl (dt (tt "reason")) (dd "the reason why awful redirected to the login page. It may be " (tt "invalid-password") ", for when the password is invalid for the given user; or " (tt "invalid-session") " for when the session identifier is not valid (e.g., the session expired).") (dt (tt "attempted-page")) (dd "the URL path to page the user tried to access, but couldn't because either he/she was not logged in or he/she provided an invalid session identifier.") (dt (tt "user")) (dd "the user used for the form user field.")) (p "Now we're gonna change our main page to store the user in the session and retrieve it to make the greetings message:") (highlight scheme "(define-page (main-page-path)\n  (lambda ()\n    ($session-set! 'user ($ 'user))\n    (++ \"Hello \" ($session 'user \"world\") \"!\")))") (p "Here we can see the two procedures to access the session: " (tt "$session") " and " (tt "$session-set!") ".") (p (tt "$session-set!") " accepts two arguments: the first one is the name of the session variable and the second one is its value.") (p (tt "$session") " takes the name of the session variable as argument and returns its session value.  We can optionally use a second argument to specify a default value, in case the session variable is not bound or is " (tt "#f") ".")) (section 3 "Session inspector" (p "Awful provides a session inspector, so we can easily see the session contents for a given session identifier.  By default, the session inspector is disabled.  We can enabled it using the " (tt "enable-session-inspector") " procedure, passing the session inspector URL path as argument:") (highlight scheme "(enable-session-inspector \"session-inspector\")") (p "Now, if you log in and try to access " (tt "http://localhost:8080/session-inspector") ", you'll get ... an access denied page.") (p "Awful provides a way to control access to the session inspector (" (tt "session-inspector-access-control") " parameter).  The " (tt "session-inspector-access-control") " parameter is an one-argument procedure which returns " (tt "#f") " or some other value to indicate whether the access to the session inspector is allowed or not. By default, it blocks all access.  Let's configure it so we can access the session inspector from the local machine (whose IP number is 127.0.0.1):") (highlight scheme "(session-inspector-access-control\n (lambda ()\n   (member (remote-address) '(\"127.0.0.1\"))))") (p "Regarding to the access denied message, you can customize it by setting the " (tt "session-inspector-access-denied-message") ".") (p "Now we can access " (tt "http://localhost:8080/session-inspector") " and see the session contents.") (p (i "Note") ": if " (tt "enable-session-cookie") " is " (tt "#f") ", you need to pass the session identifier in the query string (e.g., " (tt "http://localhost:8080/session-inspector?sid=the-session-cookie-here") ").") (p "Here's a screenshot:") (p (image-link "http://parenteses.org/mario/img/awful/session-inspector.png")) (p "When " (tt "enable-session") " is " (tt "#t") " and the " (tt "--development-mode") " option is given to the awful application server, the session inspector is automatically enabled and is avaliable from " (tt "/session-inspector") ".")) (section 3 "Web REPL" (p "For further run-time, server-side web hacking, awful provides a REPL that you can use via web browser.") (p "The web REPL can use either a plain HTML textarea for the input area or a more featureful editor (based on " (link "http://codemirror.net" "codemirror") ").  By default, the web REPL uses the " (i "fancy") " editor.") (p "The activation and control access are basically the same as for the session inspector.  The relevant procedure and parameters are:") (ul (li (tt "enable-web-repl")) (li (tt "web-repl-access-control")) (li (tt "web-repl-access-denied-message")) (li (tt "enable-web-repl-fancy-editor")) (li (tt "web-repl-fancy-editor-base-uri"))) (p "Here's a screenshot (using the fancy editor):") (p (image-link "http://parenteses.org/mario/img/awful/fancy-web-repl.png")) (p "When the " (tt "--development-mode") " option is given to the awful application server, the web REPL is automatically enabled and is avaliable from " (tt "/web-repl") ". The awful application server also accepts the " (tt "--disable-web-repl-fancy-editor") " command line option to disable the web REPL fancy editor.")) (section 3 "Pages access control" (p "To allow/deny access to pages, you can use the " (tt "page-access-control") " parameter.  It's an one-argument procedure (the page path) which can be set to determine if the access to the page is allowed or not.") (p "The example bellow shows a very silly access control to the main page: it only allows the access when the value of the request variable " (tt "user") " is " (tt "\"mario\"") ":") (highlight scheme "(use awful)\n\n(enable-session #t)\n\n(define-login-trampoline \"/login-trampoline\")\n\n(valid-password?\n (lambda (user password)\n   (equal? user password)))\n\n(page-access-control\n (lambda (path)\n   (or (member path `(,(login-page-path) \"/login-trampoline\")) ;; allow access to login-related pages\n       (and (equal? ($ 'user) \"mario\")\n            (equal? path (main-page-path))))))\n\n(define-page (main-page-path)\n  (lambda ()\n    \"Hello world\"))\n\n(define-page (login-page-path)\n  (lambda ()\n    (login-form))\n  no-session: #t)") (p "You can customize the access denied message by setting the " (tt "page-access-denied-message") " with an one-argument procedure (the page path).")) (section 3 "Compiled pages" (p "Since Chicken is a compiler and our pages are Chicken code, we can compile them to have faster pages.  We just need to compile our app and pass the generated " (tt ".so") " to the " (tt "awful") " application:") (pre " $ csc -s hello-world.scm\n $ awful hello-world.so")) (section 3 "Multiple applications support" (p "To be able to deploy multiple awful applications with different configurations under the same server, use Spiffy access files.  See Spiffy's " (int-link "/egg/spiffy#access-files" "access files documentation") " for further details.")) (section 3 "The awful application server" (p "Awful consists of an application server and an extension module.  The awful application server is a command line program whose usage is:") (pre "$ awful --help\nawful [ -h | --help ]\nawful [ -v | --version ]\nawful [ --development-mode ] [ --disable-web-repl-fancy-editor ] [ --ip-address=<ip address> ] [ --port=<port number> ] [ <app1> <app2> ... ]") (p (tt "<app1> <app2> ...") " are files containing code to be loaded by the awful application server.") (p (tt "--ip-address") " can be used to bind the web server to the given IP address.") (p (tt "--port") " can be used to make the web server listen to the given port.") (p (tt "--ip-address") " and " (tt "--port") " take precedence over the Spiffy parameters to specify the server IP address (" (tt "server-bind-address") ") and port (" (tt "server-port") ").") (p "The " (tt "--development-mode") " option is intended to be used during the development of your web application.  It's not recommended to run awful with " (tt "--development-mode") " in production.  The development mode enables the web REPL and the session inspector (when " (tt "enable-session") " is " (tt "#t") ") for the localhost, prints error messages and backtraces to the client (e.g., web browser) and HTTP server debugging messages to the " (tt "current-error-port") ".  It also makes the " (tt "/reload") " path available for reloading awful applications.") (p "When in development mode, the web REPL and the session inspector are available from the " (tt "/web-repl") " and " (tt "/session-inspector") " paths.") (p "If you enable the development mode you can still use " (tt "enable-web-repl") " and " (tt "enable-session-inspector") " to customize their respective paths and access control procedures (although the development mode always allows access to web REPL and session inspector for the localhost).") (p "The " (tt "--disable-web-repl-fancy-editor") " command line option disables the web REPL fancy editor.")) (section 3 "Deploying awful" (p "See the " (int-link "/deploying-awful" "Deploying Awful") " page on the " (link "http://wiki.call-cc.org" "Chicken Wiki") ".")) (section 3 "List of user configurable parameters" (section 4 "Debugging (parameters)" (def (sig (parameter "(debug-file [file path])" (id debug-file))) (p "If " (tt "#f") ", indicates that debugging should be disabled.  When set to a string, it should be the path to the file where the debug messages go (when " (tt "debug") " or " (tt "debug-pp") " is used.)") (p "The default value is " (tt "#f") ".")) (def (sig (parameter "(debug-db-query? [boolean])" (id debug-db-query?))) (p "When not " (tt "#f") ", all queries passed to " (tt "$db") " and to " (tt "$db-row-obj") " are printed to the debug file.") (p "The default value is " (tt "#f") ".")) (def (sig (parameter "(debug-db-query-prefix [string])" (id debug-db-query-prefix))) (p "Prefix to be used for queries debugging when " (tt "debug-db-query") " is not " (tt "#f") ".") (p "The default value is " (tt "\"\"") ".")) (def (sig (parameter "(debug-resources [boolean])" (id debug-resources))) (p "When " (tt "#t") ", enables debugging of awful's resources table (an alist mapping paths (or regexes) and vhost paths to their corresponding procedures to be executed on the server side upon request).  The debugging data is sent to the file pointed by " (tt "debug-file") ".  The default value is " (tt "#f") "."))) (section 4 "Database (parameters)" (def (sig (parameter "(db-credentials [boolean or list])" (id db-credentials))) (p "Credentials to be used to access the database (see the documentation for the egg corresponding to the database backend you selected.)  When " (tt "#f") ", no database access is performed.") (p "The default value is " (tt "#f") "."))) (section 4 "Ajax (parameters)" (def (sig (parameter "(ajax-library [string])" (id ajax-library))) (p "URL or path to the ajax library (currently only " (link "http://jquery.com" "JQuery") " is supported.)") (p "The default value is " (tt "\"http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js\""))) (def (sig (parameter "(enable-ajax [boolean])" (id enable-ajax))) (p "When " (tt "#t") ", makes " (tt "define-page") " link the " (tt "ajax-library") " to the generated page.  It's effect is global, that is, once " (tt "enable-ajax") " is set to " (tt "#t") ", all pages defined via " (tt "define-page") " will be linked to the ajax library, unless when the " (tt "no-ajax") " keyword parameter is explicitly set.") (p "The default value is " (tt "#f"))) (def (sig (parameter "(ajax-namespace [string])" (id ajax-namespace))) (p "Name to be used as a namespace for ajax URL paths.") (p "The default value is " (tt "\"ajax\"") ".")) (def (sig (parameter "(ajax-invalid-session-message [string])" (id ajax-invalid-session-message))) (p "The message to be used when attempting the make an ajax call using an invalid session identifier.") (p "The default value is " (tt "\"Invalid session\"") "."))) (section 4 "Sessions (parameters)" (def (sig (parameter "(enable-session [boolean])" (id enable-session))) (p "When " (tt "#t") ", session support is enabled.") (p "The default value is " (tt "#f") ".")) (def (sig (parameter "(enable-session-cookie [boolean])" (id enable-session-cookie))) (p "When " (tt "#t") ", awful uses cookies to store the session identifier.  Otherwise, the session identifier is passed as a value in the query string or in the request body. The default value is " (tt "#t") ".")) (def (sig (parameter "(session-cookie-name [string])" (id session-cookie-name))) (p "The name of the cookie for storing the session identifier.  The dafult value is " (tt "\"awful-cookie\"") "."))) (section 4 "Access control (parameters)" (def (sig (parameter "(page-access-control [procedure])" (id page-access-control))) (p "An one-argument (URL path of the current page) procedure which tells whether the access to the page is allowed or not.") (p "The default value is " (tt "(lambda (path) #t)") ".")) (def (sig (parameter "(page-access-denied-message [procedure])" (id page-access-denied-message))) (p "An one-argument (URL path of the current page) procedure which returns the access denied message.") (p "The default value is " (tt "(lambda (path) (<h3> \"Access denied.\"))") ".")) (def (sig (parameter "(valid-password? [procedure])" (id valid-password?))) (p "A two-argument (user and password) procedure which indicates whether the given password is valid for the given user.") (p "The default value is " (tt "(lambda (user password) #f)") "."))) (section 4 "Pages (parameters)" (def (sig (parameter "(page-doctype [string])" (id page-doctype))) (p "The doctype (see the " (int-link "/egg/doctype" "doctype") " egg) to be applied to all pages defined by " (tt "define-page") ".  It can be overwritten by " (tt "define-page") "'s " (tt "doctype") " keyword parameter.") (p "The default value is " (tt "\"\"") ".")) (def (sig (parameter "(page-css [boolean or string])" (id page-css))) (p "The CSS file to be linked by all pages defined by " (tt "define-page") ".  It can be overwritten by " (tt "define-page") "'s " (tt "css") " keyword parameter.  See " (int-link "/egg/html-utils" "html-utils") "'s " (tt "html-page") " procedure to know about the " (tt "css") " keyword parameter syntax.") (p "The default value is " (tt "#f") " (no CSS).")) (def (sig (parameter "(page-charset [boolean or string])" (id page-charset))) (p "The page charset to be used by all pages defined by " (tt "define-page") ".  It can be overwritten by " (tt "define-page") "'s " (tt "charset") " keyword parameter. The default value is " (tt "#f") " (no explicit charset).")) (def (sig (parameter "(page-template [procedure])" (id page-template))) (p "An one-mandatory-argument procedure to be used by " (tt "define-page") " (unless " (tt "define-page") "'s " (tt "no-template") " keyword parameter is set to " (tt "#f") ") to generate HTML pages. Although this procedure can take only one mandatory argument, the following keyword arguments are passed:") (ul (li "css") (li "title") (li "doctype") (li "headers") (li "charset") (li "no-ajax") (li "no-template") (li "no-session") (li "no-db")) (p "The default value is " (tt "html-page") " (see the " (int-link "/egg/html-utils" "html-utils") " egg documentation.)")) (def (sig (parameter "(page-exception-message [procedure])" (id page-exception-message))) (p "An one-argument procedure to be used when an exception occurs while " (tt "define-page") " tries to evaluate its contents.") (p "The default value is " (tt "(lambda (exn) (<h3> \"An error has accurred while processing your request.\"))")))) (section 4 "Page paths (parameters)" (def (sig (parameter "(main-page-path [string])" (id main-page-path))) (p "The URL path to the app main page.") (p "The default value is " (tt "\"/\"") ".")) (def (sig (parameter "(app-root-path [string])" (id app-root-path))) (p "The base path to be used by the application.  All the pages defined by " (tt "define-page") " will use " (tt "app-root-path") " as the base directory.  For example, if " (tt "app-root-path") " is set to " (tt "\"/my-app\"") " and " (tt "\"my-page\"") " is used as first argument to " (tt "define-page") ", the page would be available at " (tt "http://<server>:<port>/my-app/my-page") ".") (p "The default value is " (tt "\"/\"") ".")) (def (sig (parameter "(login-page-path [string])" (id login-page-path))) (p "The URL path for the login page.  When creating a login page, be sure to set the " (tt "no-session") " keyword parameter for " (tt "define-page") " to " (tt "#t") ", otherwise you'll get an endless loop.") (p "The default value is " (tt "\"/login\"") "."))) (section 4 "Headers (parameters)" (def (sig (parameter "(awful-response-headers [alist])" (id awful-response-headers))) (p "An alist to specify the headers to be used in the response.  If the " (tt "content-length") " header is not provided, awful will calculate it automatically.") (p "Here's an example:") (highlight scheme "#!/usr/bin/awful\n\n(use awful)\n\n(define (define-json path body)\n  (define-page path\n    (lambda ()\n      (awful-response-headers '((content-type \"text/json\")))\n      (body))\n    no-template: #t))\n\n\n(define-json (main-page-path)\n  (lambda ()\n    \"{a: 1}\"))"))) (section 4 "Web REPL (parameters)" (def (sig (parameter "(web-repl-access-control [procedure])" (id web-repl-access-control))) (p "A no-argument procedure to control access to the web REPL.") (p "The default value is " (tt "(lambda () #f)") ".")) (def (sig (parameter "(web-repl-access-denied-message [string])" (id web-repl-access-denied-message))) (p "Message to be printed when the access to the web REPL is denied.") (p "The default value is " (tt "(<h3> \"Access denied.\")") ".")) (def (sig (parameter "(enable-web-repl-fancy-editor [boolean])" (id enable-web-repl-fancy-editor))) (p "Indicates whether the web REPL should use a fancier editor for the input area.  The editor is based on " (link "http://codemirror.net" "codemirror") ".  Without the fancy editor, the input area is a simple HTML textarea.  The default value for " (tt "use-fancy-editor") " is " (tt "#t") ".")) (def (sig (parameter "(fancy-editor-base-uri [string])" (id fancy-editor-base-uri))) (p "The URI which indicates the fancy editor source files (javascript and CSS) location.  The default value is " (tt "http://parenteses.org/awful/codemirror") "."))) (section 4 "Session inspector (parameters)" (def (sig (parameter "(session-inspector-access-control [procedure])" (id session-inspector-access-control))) (p "A no-argument procedure to control access to the session inspector.") (p "The default value is " (tt "(lambda () #f)") ".")) (def (sig (parameter "(session-inspector-access-denied-message [string])" (id session-inspector-access-denied-message))) (p "Message to be printed when the access to the session inspector is denied.") (p "The default value is " (tt "(<h3> \"Access denied.\")") "."))) (section 4 "Javascript (parameters)" (def (sig (parameter "(enable-javascript-compression [boolean])" (id enable-javascript-compression))) (p "Enable javascript compression support.  When enabled the compressor set by " (tt "javascript-compressor") " is used.") (p "The default value is " (tt "#f") ".")) (def (sig (parameter "(javascript-compressor [procedure])" (id javascript-compressor))) (p "An one-argument procedure (the javascript code) which return the given javascript code compressed.  Only used when " (tt "enable-javascript-compression") " is not " (tt "#f") ".") (p "The default value is the " (tt "identity") " procedure.") (p "A possible value for " (tt "javascript-compressor") " is " (tt "jsmin-string") " (see the " (int-link "/egg/jsmin" "jsmin") " egg.)")))) (section 3 "List of read-only parameters available to users" (p "Note: these parameters should not be explicitly set and when their use is needed, it's a string sign you're doing something you shouldn't (except for " (tt "db-connection") ", which can be used by procedures from the " (int-link "/egg/postgresql" "postgresql") " egg API).") (def (sig (parameter "(http-request-variables)" (id http-request-variables))) (p "The per-request value returned by " (int-link "/egg/spiffy-request-vars" "spiffy-request-vars") "'s " (tt "request-vars") ".")) (def (sig (parameter "(db-connection)" (id db-connection))) (p "A per-request databaseconnection object.  The connection is automatically opened and closed by awful in a per-request basis (unless databases are not being used the " (tt "no-db") " keyword parameter for " (tt "define-page") " is " (tt "#t") ".)")) (def (sig (parameter "(page-javascript)" (id page-javascript))) (p "Javascript code to be added to the pages defined by " (tt "define-page") ".")) (def (sig (parameter "(sid)" (id sid))) (p "The session identifier.")) (def (sig (parameter "(awful-apps)" (id awful-apps))) (p "The list of awful applications, as given to the awful server when invoked from the command line.")) (def (sig (parameter "(development-mode?)" (id development-mode?))) (p "Indicates whether awful is running in development mode (see the " (tt "--development-mode") " command line option for the awful application server)."))) (section 3 "List of procedures" (section 4 "Miscelaneous" (def (sig (procedure "(++ string1 string2 ... stringn)" (id ++))) (p "A shortcut to " (tt "string-append") ".")) (def (sig (procedure "(concat args #!optional (sep \"\"))" (id concat))) (p "Convert " (tt "args") " to string and intersperse the resulting strings with " (tt "sep") ".")) (def (sig (procedure "(awful-version)" (id awful-version))) (p "Return the awful version (a string)."))) (section 4 "Javascript" (def (sig (procedure "(include-javascript . files)" (id include-javascript))) (p "A shortcut to " (tt "(<script> type: \"text/javascript\" src: file)") ".")) (def (sig (procedure "(add-javascript . code)" (id add-javascript))) (p "Add arbitrary javascript code to the pages defined by " (tt "define-page") " and " (tt "define-session-page") "."))) (section 4 "Debugging" (def (sig (procedure "(debug . args)" (id debug))) (p "Print " (tt "args") ", concatenated, to the file " (tt "debug-file") ".")) (def (sig (procedure "(debug-pp arg)" (id debug-pp))) (p "Pretty-print " (tt "arg") " to the file " (tt "debug-file") "."))) (section 4 "Sessions and authentication" (def (sig (procedure "($session var #!optional default)" (id $session))) (p "Return the value of " (tt "var") " in the session (or " (tt "default") " if " (tt "var") " does not exist or is " (tt "#f") ").")) (def (sig (procedure "($session-set! var #!optional val)" (id $session-set!))) (p "If " (tt "var") " is a quoted symbol, set the value of " (tt "var") " to " (tt "val") ".  If " (tt "val") " is not provided, " (tt "var") " will have its value set to " (tt "#f") ".") (p (tt "var") " can be an alist mapping session variable names to their corresponding values.") (p "Examples:") (highlight scheme "($session-set! 'foo \"foo value\")\n\n($session-set! '((foo . \"foo value\")\n                 (bar . \"bar value\")\n                 (baz . \"baz value\")))")) (def (sig (procedure "(link url text . rest)" (id link))) (p "Return a session-aware HTML code for a link, using the " (tt "<a>") " procedure from " (int-link "/egg/html-tags" "html-tags") ".") (p "The " (tt "rest") " arguments are the same as the ones for the " (tt "<a>") " procedure from " (int-link "/egg/html-tags" "html-tags") ", plus the following:") (dl (dt (tt "no-session")) (dd "a boolean.  If " (tt "#t") ", forces " (tt "link") " to ignore the session even when " (tt "enable-session") " is " (tt "#t") ".") (dt (tt "arguments")) (dd "an alist mapping variable names to their corresponding values, to be passed to uri-common's " (tt "form-urlencode") " procedure.") (dt (tt "separator")) (dd "the value to the " (tt "separator") " keyword argument to be passed to to uri-common's " (tt "form-urlencode") " procedure.")) (p "When " (tt "enable-session") " is " (tt "#t") ", " (tt "link") " automatically encodes the session identifier in the URI (unless " (tt "no-session") " is " (tt "#t") ").")) (def (sig (procedure "(form contents . rest)" (id form))) (p "Return a session-aware HTML code for a form, using the " (tt "<form>") " procedure from " (int-link "/egg/html-tags" "html-tags") ".") (p "The " (tt "rest") " arguments are the same as the ones for the " (tt "<form>") " procedure from " (int-link "/egg/html-tags" "html-tags") ", plus " (tt "no-session") ", a boolean.  If " (tt "no-session") " is " (tt "#t") ", it forces " (tt "form") " to ignore the session even when " (tt "enable-session") " is " (tt "#t") ".") (p "When " (tt "enable-session") " is " (tt "#t") ", " (tt "form") " automatically generates a hidden input field to pass the session identifier (unless " (tt "no-session") " is " (tt "#t") ").")) (def (sig (procedure "(define-login-trampoline path #!key vhost-root-path hook)" (id define-login-trampoline))) (p "Define a trampoline -- an intermediate page accessed when redirecting from the login page to the main page.")) (def (sig (procedure "(login-form #!key (user-label \"User: \") (password-label \"Password: \") (submit-label \"Submit\") (refill-user #t))" (id login-form))) (p "Return a user/password login form (e.g., for using in authentication pages).") (p "When the " (tt "refill-user") " is " (tt "#t") ", the User field is reffiled with the value from the " (tt "user") " query string value when either the session or the password is invalid.") (p "The " (tt "user-label") ", " (tt "password-label") " and " (tt "submit-label") " keyword parameters are labels to be used for the user, password and submit form widgets, respectively."))) (section 4 "Request variables and values" (def (sig (procedure "($ var #!optional default/converter)" (id $))) (p "Return the HTTP request value for the given variable " (tt "var") ".  The variable is looked for in both the query string (GET method) and request body (e.g., POST method).  See the documentation for the procedure returned by " (int-link "/eggref/4/spiffy-request-vars" "spiffy-request-vars") "'s " (tt "request-vars") " for further details."))) (section 4 "Database access" (def (sig (procedure "($db q #!key default values)" (id $db))) (p "Execute the given query (" (tt "q") ") on the database and return the result as a list of lists or " (tt "default") " if the result set is empty.") (p "The " (tt "values") " keyword parameter (a list) is a list of values to replace the placehoders in the query.") (p "Example:") (highlight scheme "($db \"insert into foo (bar, baz) values (?, ?)\" values: '(\"bar-val\" \"baz-val\"))")) (def (sig (procedure "($db-row-obj q)" (id $db-row-obj))) (p "Execute the given query " (tt "q") " on the database and return an one-argument procedure which takes as argument the name of the database field to get the value.") (p "Example:") (highlight scheme "(let ((& ($db-row-obj \"select full_name, phone from users where user_id=1\")))\n  (<p> \"Full name: \" (& 'full_name))\n  (<p> \"Phone: \" (& 'phone)))") (p (i "Warning") ": currently " (tt "$db-row-obj") " is only implemented for Postgresql databases.")) (def (sig (procedure "(sql-quote . data)" (id sql-quote))) (p "Escape and quote the concatenation of " (tt "data") " to be used in SQL queries.") (p (i "Warning") ": for Sqlite databases, " (tt "sql-quote") " just replaces " (tt "'") " by " (tt "''") " and quotes the " (tt "data") ".  For Postgresql, " (tt "sql-quote") " quotes the result of " (tt "escape-string") "."))) (section 4 "Pages" (def (sig (procedure "(define-page path contents #!key css title doctype headers charset no-ajax use-ajax no-template no-session no-db no-javascript-compression)" (id define-page))) (p "Define an awful page.") (p (tt "path") " is the path to the page.  It can be represented by two types: a string and a regular expression object.  If it is a string, the path used in the URI will be bound to the given no-argument procedure " (tt "contents") ".  If it is a regular expression object, any request whose URL path matches the regular expression will br handled by the one-argument procedure " (tt "contents") ".  This procedure will be given the requested path.") (p "The " (tt "css") ", " (tt "title") ", " (tt "doctype") ", " (tt "headers") " and " (tt "charset") " keyword parameters have the same meaning as " (tt "html-page") " (from the " (int-link "/egg/html-utils" "html-utils") " egg).") (p "If " (tt "no-ajax") " is " (tt "#t") ", it means that the page won't use ajax, even if the " (tt "enable-ajax") " parameter is " (tt "#t") ".") (p "If " (tt "use-ajax") " is " (tt "#t") ", it means that the page will be linked to the ajax library, even if the " (tt "enable-ajax") " parameter is " (tt "#f") ".") (p "If " (tt "no-template") " is " (tt "#t") ", it means that no page template (see the " (tt "page-template") " parameter) should be used.") (p "If " (tt "no-session") " is " (tt "#t") ", it means that the page should not use session.") (p "If " (tt "no-db") " is " (tt "#t") ", it means that the page should not use the database, even when database usage is activated by " (tt "enable-db") " and " (tt "db-credentials") " is not " (tt "#f") ".") (p "If " (tt "no-javascript-compression") " is " (tt "#t") " the javascript code for the page is not compressed, even when " (tt "enable-javascript-compression") " is not " (tt "#f") ".") (p "Examples:") (highlight scheme "\n(use srfi-1 ;; for filter-map\n     regex) ;; for regexp\n\n;; http://host:port/foo => \"bar\"\n(define-page \"/foo\"\n  (lambda ()\n    \"bar\"))\n\n;; http://host:port/add/1/2/3 => 6\n(define-page (regexp \"/add/.*\")\n  (lambda (path)\n    (let ((numbers (filter-map string->number (string-split path \"/\"))))\n      (number->string (apply + numbers)))))\n")) (def (sig (procedure "(define-session-page path contents . rest)" (id define-session-page))) (p "Define a session-aware page.  When the page is accessed and a correponding session does not exist, it is created.  If the session already exists and is not valid, it is recreated.  If the session already exists and is valid, then it is refreshed.") (p "The " (tt "rest") " parameters are the same as for " (tt "define-page") ".") (p "Here's an example (the " (link "http://www.paulgraham.com/arcchallenge.html" "arc challenge") "):") (highlight scheme "(use awful html-utils spiffy-request-vars)\n\n(define-session-page \"said\"\n  (lambda ()\n    (with-request-vars* $ (said)\n      (cond (said\n             ($session-set! 'said said)\n             (link \"said\" \"click here\"))\n            (($session 'said)\n             => (lambda (said)\n                  (++ \"You said: \" said)))\n            (else (form (++ (text-input 'said)\n                            (submit-input))\n                        action: \"said\"\n                        method: 'post))))))")) (def (sig (procedure "(undefine-page path #!optional vhost-root-path)" (id undefine-page))) (p "Undefine a page whose path is " (tt "path") " (a string or a regular expression object).") (p "The optional parameter " (tt "vhost-root-path") " is the path of virtual host where the page is to be undefined.  If omited, " (tt "(root-path)") " is used."))) (section 4 "Ajax" (def (sig (procedure "(ajax path selector event proc #!key target (action 'html) (method 'POST) (arguments '()) success no-session no-db vhost-root-path live prelude update-targets)" (id ajax))) (p "Generate javascript code to be added to the page defined by " (tt "define-page") ".  Return the generated javascript code (which usually is not useful, so should be discarded).") (p (tt "path") " is the URL path (a string) of the server side handler. This path is placed under the " (tt "(app-root-path)/(ajax-namespace)") " path.  So, if your " (tt "app-root-path") " is " (tt "\"my-app\"") ", your " (tt "ajax-namespace") " is " (tt "\"ajax\"") " and you use " (tt "\"do-something\"") " as the first argument to " (tt "ajax") ", the URL for the server side handler would be " (tt "\"/my-app/ajax/do-something\"") ".") (p (tt "selector") " is the selector for the DOM element to be observed.  If it is a quoted symbol, awful generates a JQuery selector by DOM id (e.g., " (tt "'my-selector") " generates " (tt "\"#my-selector\"") ").  If it is a string, awful uses it as-is to generate the JQuery selector (e.g., " (tt "\"input[name^=omg]\"") " generates " (tt "\"input[name^=omg]\"") ").") (p (tt "event") " (a quoted symbol or a list) is the event(s) to be observed. If it is a quoted symbol (e.g., " (tt "'click") "), only this event will be bound.  If " (tt "event") " is a list of events, all the events from the list will be bound.") (p (tt "proc") " is a no-argument procedure to be executed on the server side.") (p "The " (tt "target") " keyword parameter is the id of the DOM element to be affected by the result of " (tt "proc") ".") (p "The " (tt "method") " (a quoted symbol, usually " (tt "'GET") " or " (tt "'POST") ") keyword parameter is the HTTP method to be used by the ajax request.") (p "The " (tt "arguments") " keyword parameter is an alist mapping request variables (symbols) to their values (strings).  " (tt "ajax") " uses these arguments to assembly the query string or the request body to send to the server when performing the ajax request.") (p "Example:") (highlight scheme "arguments: '((var1 . \"$('#var1').val()\")\n             (var2 . \"$('#var2').val()\"))") (p "If the " (tt "no-session") " keyword parameter is " (tt "#t") ", it means that no session should be considered (" (tt "ajax") " implicit sends the session identifier when " (tt "no-session") " is " (tt "#f") ").") (p "If the " (tt "no-db") " keyword parameter is " (tt "#t") ", it means that the should be no attempt to connect the database, even when database usage is activated by " (tt "enable-db") " and " (tt "db-credentials") " is not " (tt "#f") ".") (p "The " (tt "vhost-root-path") " keyword parameter (a string) is the vhost root path.  It is useful for explicitly separate pages defined using the same path (see " (tt "define-page") ") but for different vhosts.") (p "The " (tt "live") " keyword parameter (boolean) indicates wheter ajax should use JQuery's live method (see " (link "http://api.jquery.com/live/") ").") (p "The " (tt "prelude") " keyword parameter (string) is an arbitrary piece of javascript code to be placed right before the ajax request.") (p "The " (tt "update-targets") " keyword parameter a boolean indicating whether multiple targets should be updated upon ajax response.  When " (tt "update-targets") " is used, the procedure " (tt "proc") " used as argument to " (tt "ajax") " should yield an alist as result.  The alist maps DOM elements identifiers to their corresponding values.") (p "Here's an example:") (highlight scheme "#!/usr/bin/awful\n\n(use awful html-tags)\n\n(enable-ajax #t)\n\n(define-page (main-page-path)\n  (lambda ()\n\n    (ajax \"foo\" 'foo 'click\n          (lambda ()\n            '((a . 1) (b . 2) (c . 3)))\n          update-targets: #t)\n\n    (<div>\n     (link \"#\" \"foo\" id: \"foo\")\n     (<div> id: \"a\")\n     (<div> id: \"b\")\n     (<div> id: \"c\"))))") (p "The " (tt "success") " keyword parameter (string) can be any arbitrary javascript code to be executed on the successful ajax request.  The javascript code can assume that a variable " (tt "response") " is bound and contains the request resulting data.  Here's an example:") (highlight scheme "#!/usr/bin/awful\n\n(use awful html-tags)\n\n(enable-ajax #t)\n\n(define-page (main-page-path)\n  (lambda ()\n\n    (ajax \"foo\" 'foo \"click\"\n          (lambda ()\n            \"hey\")\n          success: \"$('#bar').html(response + ' you!')\")\n\n    (++ (link \"#\" \"foo\" id: \"foo\")\n        (<div> id: \"bar\"))))") (p "The " (tt "ajax") " procedure is session, HTTP request and database -aware.")) (def (sig (procedure "(periodical-ajax path interval proc #!key target (action 'html) (method 'POST) (arguments '()) success no-session no-db vhost-root-path live prelude update-targets)" (id periodical-ajax))) (p "Periodically execute " (tt "proc") " on the server side, using " (tt "(app-root-path)/(ajax-namespace)/path") " as the URL path for the server side handler.") (p (tt "interval") " (a number) is the interval between consecutive executions of " (tt "proc") ", in milliseconds.") (p "The meaning of the keyword parameters is the same as for " (tt "ajax") "'s.")) (def (sig (procedure "(ajax-link path id text proc #!key target (action 'html) (method 'POST) (arguments '()) success no-session no-db (event 'click) vhost-root-path live class hreflang type rel rev charset coords shape accesskey tabindex a-target prelude update-targets)" (id ajax-link))) (p "A shortcut to") (highlight scheme "(begin\n  (ajax path id 'click proc ...)\n  (<a> href: \"#\" [...other <a> keyword parameters...] id: id text))") (p "The meaning of the " (tt "target") ", " (tt "action") ", " (tt "method") ", " (tt "arguments") ", " (tt "success") ", " (tt "no-session") ", " (tt "no-db") ", " (tt "event") ", " (tt "vhost-root-path") ", " (tt "update-targets") " and " (tt "live") " keyword parameters is the same as for " (tt "ajax") "'s.") (p "The meaning of the " (tt "class") ", " (tt "hreflang") ", " (tt "type") ", " (tt "rel") ", " (tt "rev") ", " (tt "charset") ", " (tt "coords") ", " (tt "shape") ", " (tt "accesskey") ", " (tt "tabindex") " and " (tt "a-target") " are the same as for " (int-link "/egg/html-tags" "html-tags") "' " (tt "<a>") " procedure (except that " (tt "a-target") " is " (tt "<a>") "'s " (tt "target") ", since " (tt "ajax") " uses the " (tt "target") " keyword parameter).") (p "The " (tt "event") " keyword parameter syntax is the same for " (tt "ajax") "'s " (tt "event") " mandatory parameter."))) (section 4 "Redirection" (def (sig (procedure "(redirect-to uri)" (id redirect-to))) (p "Perform an HTTP redirection (code 302) to the given " (tt "uri") " (either a string or a " (int-link "/eggref/4/uri-common" "uri-common") " uri object).  To be used from " (tt "define-page") " contents.  Example:") (highlight scheme "(use awful)\n\n;; / -> /foo\n(define-page \"/\"\n  (lambda ()\n    (redirect-to \"/foo\")))\n\n(define-page \"/foo\"\n  (lambda ()\n    \"foo\"))") (p "The example above shows a redirection from " (tt "/") " to " (tt "/foo") ".  Redirections can also be performed when the origin path is a regular expression:") (highlight scheme "(use awful)\n\n;; /bar.* -> /foo\n(define-page (regexp \"/bar.*\")\n  (lambda (_)\n    (redirect-to \"/foo\")))\n\n(define-page \"/foo\"\n  (lambda ()\n    \"foo\"))"))) (section 4 "Web REPL" (def (sig (procedure "(enable-web-repl path #!key css title)" (id enable-web-repl))) (p "Enable the web REPL.  " (tt "path") " is the URL path to the web REPL.") (p "The keyword parameter " (tt "css") " is the CSS to be used the the web REPL page (see the documentation for " (tt "html-page") ", from the " (int-link "/egg/html-utils" "html-utils") " egg, for the " (tt "css") " keyword parameter.)") (p "The keyword parameter " (tt "title") " (a string) is the title for the web REPL page (see the documentation for " (tt "html-page") ", from the " (int-link "/egg/html-utils" "html-utils") " egg, for the " (tt "title") " keyword parameter.)") (p "The web REPL is automatically enabled by the awful application server when the " (tt "--development-mode") " is provided (available from " (tt "/web-repl") ").  By default, the fancy editor is used, but can be disabled with the " (tt "--disable-web-repl-fancy-editor") " command line option for the awful application server."))) (section 4 "Session inspector" (def (sig (procedure "(enable-session-inspector path #!key css title)" (id enable-session-inspector))) (p "Enable the session inspector.  " (tt "path") " is the URL path to the session inspector.") (p "The keyword parameter " (tt "css") " is the CSS to be used the the session inspector page (see the documentation for " (tt "html-page") ", from the " (int-link "/egg/html-utils" "html-utils") " egg, for the " (tt "css") " keyword parameter.)") (p "The keyword parameter " (tt "title") " (a string) is the title for the session inspector page (see the documentation for " (tt "html-page") ", from the " (int-link "/egg/html-utils" "html-utils") " egg, for the " (tt "title") " keyword parameter.)") (p "The session inspector is automatically enabled by the awful application server when the " (tt "--development-mode") " is provided (available from " (tt "/session-inspector") ").")))) (section 3 "Tips and tricks" (section 4 ("Use " (tt "link") " and " (tt "form") " for links and forms") (p "Instead of using " (tt "<a>") " and " (tt "<form>") " for creating links and forms, respectively, consider using the " (tt "link") " and " (tt "form") " procedures instead.  They are specially useful when using sessions, since they transparently handle the session identifier for you.  Even if you don't use sessions, they may save you some work if one day you decide to use sessions (then you won't have do to anything regarding to links and forms).")) (section 4 ("Use " (tt "with-request-vars") " when referencing the same request variable multiple times") (p "When you need to access the same request variable more than once, consider using " (int-link "/egg/spiffy-request-vars" "spiffy-request-vars") "' " (tt "with-request-vars") ".") (p "For example, instead of:") (highlight scheme "(use awful)\n\n(define-page \"save-and-show-user\"\n  (lambda ()\n    ($session-set! 'user ($ 'user))\n    (++ \"Welcome \" ($ 'user) \"!\")))") (p "consider using something like:") (highlight scheme "(use awful spiffy-request-vars)\n\n(define-page \"save-and-show-user\"\n  (lambda ()\n    (with-request-vars $ (user)\n      ($session-set! 'user user)\n      (++ \"Welcome \" user))))")) (section 4 "Use the web REPL and the session inspector for debugging" (p "You can simply use the " (tt "--development-mode") " option for the awful application server to enable the web REPL and the session inspector (when " (tt "enable-session") " is " (tt "#t") ").  The development mode allows access to them for the localhost.  When in development mode, the web REPL and the session inspector are available at the " (tt "/web-repl") " and " (tt "/session-inspector") " paths.") (p "If you want further flexibility, you can customize the web REPL and the session inspector.") (p "Here's a simple recipe to allow access for your local machine to the web REPL (" (tt "/repl") ") and to the session inspector (" (tt "/session-inspector") ").") (highlight scheme "(session-inspector-access-control\n (lambda ()\n   (member (remote-address) '(\"127.0.0.1\"))))\n\n(enable-session-inspector \"/session-inspector\")\n\n\n(web-repl-access-control\n (lambda ()\n   (member (remote-address) '(\"127.0.0.1\"))))\n\n(enable-web-repl \"/repl\")") (p "To access them, just point your browser to " (tt "http://localhost:<port>/repl") " and " (tt "http://localhost:<port>/session-inspector") ", respectively.")) (section 4 ("Create custom page definers when " (tt "page-template") " and/or plain " (tt "define-page") " are not enough") (p "You can define your own page definers when " (tt "page-template") " or the plain " (tt "define-page") " is not enough for what you need.  Here's an example:") (highlight scheme "#!/usr/bin/awful\n\n(use awful html-tags)\n\n(define (define-custom-page path contents)\n  (define-page path\n    (lambda ()\n      (<html> (<body> (contents))))\n    no-template: #t))\n\n(define-custom-page (main-page-path)\n  (lambda ()\n    \"Hey!\"))") (p "If you access " (tt "http://localhost:8080") " you'll get the following HTML code:") (pre " <html><body>Hey!</body></html>")) (section 4 "Debugging: error messages on the browser window" (p "Error messages right on the browser window can be quite handy for debugging (although not for production environments).  Here's a way to accomplish that:") (highlight scheme "(use awful html-tags)\n\n(page-exception-message\n (lambda (exn)\n   (<pre> convert-to-entities?: #t\n          (with-output-to-string\n            (lambda ()\n              (print-call-chain)\n              (print-error-message exn))))))") (p "This feature is automatically enabled when the awful application server is used with the " (tt "--development-mode") " option.")) (section 4 "Run awful without arguments to quickly share a file" (p "When invoked without arguments, awful (the application) starts the web server using the current directory as root path and keeps listening on port 8080.  So, if you want to quickly share a file (or some files), change to the directory containing the files and execute " (tt "awful") ".  The access " (tt "http://<host>:8080/<the-file-you-want>") ".")) (section 4 "Awful & SXML" (p "By default, awful uses " (link "http://wiki.call-cc.org/egg/html-tags" "html-tags") " to generate HTML for pages.  Of course, it can be changed, and you can even use SXML.  Here's an example by setting the " (tt "page-template") " parameter to use SXML (see the " (link "http://wiki.call-cc.org/egg/sxml-transforms" "sxml-transforms egg") "):") (highlight scheme "(use awful sxml-transforms)\n\n(page-template\n (lambda (contents . rest)\n   (with-output-to-string\n     (lambda ()\n       (SXML->HTML `(html (body ,contents)))))))\n\n(define-page (main-page-path)\n  (lambda ()\n    '(p \"Awful SXML example\")))") (p "Alternatively, you can create a " (tt "define-sxml-page") " procedure which calls " (tt "define-page") " (disabling " (tt "page-template") ") and do the SXML transformations in the page definition body:") (highlight scheme "(use awful sxml-transforms)\n\n(define (define-sxml-page path contents)\n  (define-page path\n    (lambda ()\n      (with-output-to-string\n        (lambda ()\n          (SXML->HTML `(html (body ,(contents)))))))\n    no-template: #t))\n\n(define-sxml-page (main-page-path)\n  (lambda ()\n    '(p \"Awful SXML example\")))")) (section 4 "Awful badge" (p "Here's a suggestion:  " (image-link "http://parenteses.org/mario/img/thats-awful.png")))) (section 3 "Examples" (p "Here are some simple examples using assorted awful features.") (section 4 "Number guessing game" (p "A screencast showing this example is available at " (link "http://wiki.call-cc.org/video/awful-guess.ogv" "http://wiki.call-cc.org/video/awful-guess.ogv")) (p "This examples shows a simple guessing game. A random number is generated on the server side and the user tries to guess it.  It shows some basic ajax features.") (highlight scheme "(use awful html-tags spiffy-request-vars)\n\n(enable-ajax #t)\n\n(define (prompt-guess)\n  (<input> type: \"text\" id: \"guess\"))\n\n(define-page (main-page-path)\n  (lambda ()\n    (ajax \"try-guess\" 'guess 'change\n          (lambda ()\n            (let ((guess ($ 'guess as-number))\n                  (thinking (random 10)))\n              (<p> (if (and guess (= guess thinking))\n                       \"You guessed it right!\"\n                       (conc \"You guessed it wrong. I'm thinking \" thinking \".\")))))\n            target: \"verdict\"\n            arguments: '((guess . \"$('#guess').val()\")))\n    (++ (<p> \"Guess the number I'm thinking:\")\n        (prompt-guess)\n        (<div> id: \"verdict\"))))") (p "To run it, execute:") (pre " $ awful number-guess.scm") (p "(considering you saved the code above in a file called " (tt "number-guess.scm") "), then access " (tt "http://localhost:8080") ".")) (section 4 "Sandoxed Chicken Web REPL" (p "This example was featured in the " (link "http://gazette.call-cc.org/issues/10.html" "Chicken Gazette #10") ".") (p "It shows how to implement a very simple web-based Chicken REPL using a sandbox environment (see the " (link "http://wiki.call-cc.org/egg/sandbox" "sandbox egg") " documentation) for safe evaluation.") (p "The idea is to have a web page with an input box. Users type the forms they want to evaluate and submit them to the server. The server evaluates the given forms in a sandbox environment and return the results.") (p "Here's the commented code:") (highlight scheme "(use html-tags awful sandbox)\n\n;; Here we define the REPL page.  It uses the session to store the\n;; sandboxed environment.  By default, the `main-page-path' parameter\n;; value is \"/\".\n(define-session-page (main-page-path)\n  (lambda ()\n\n    ;; Create the sandbox environment (if it does not exist yet) and\n    ;; store it in the user session.\n    (unless ($session 'sandbox-env)\n      ($session-set! 'sandbox-env\n                     (make-safe-environment\n                      parent: default-safe-environment\n                      mutable: #t\n                      extendable: #t)))\n\n    ;; Here we set an ajax handler for the REPL expressions\n    ;; submission.  When users change the REPL input widget (i.e., by\n    ;; pressing ENTER), the contents of the text input field are\n    ;; submitted and handled by the procedure given as the forth\n    ;; argument to `ajax'.\n    (ajax \"eval\" 'repl-input 'change\n          (lambda ()\n\n            ;; This binds the variable `repl-input' from the POST\n            ;; method the the `repl-input' Scheme variable\n            (let ((repl-input ($ 'repl-input)))\n\n              ;; We'd better handle exceptions when trying to\n              ;; evaluate the expressions given by users.\n              (handle-exceptions\n               exn\n               ;; If something goes wrong, we print the error message\n               ;; and the call chain.\n               (<pre> convert-to-entities?: #t\n                      (with-output-to-string\n                        (lambda ()\n                          (print-error-message exn)\n                          (print-call-chain))))\n               ;; Here we try to evaluate the given expression in the\n               ;; sandboxed environment stored in the user session. \n               ;; The `repl-output' page div is updated with the result.\n               (<pre> convert-to-entities?: #t\n                      (safe-eval\n                       (with-input-from-string repl-input read)\n                       fuel: 100\n                       allocation-limit: 100\n                       environment: ($session 'sandbox-env))))))\n\n          ;; Here we pass the contents of the text input to the ajax\n          ;; handler.  The default HTTP method used by `ajax' is POST.\n          arguments: `((repl-input . \"$('#repl-input').val()\"))\n\n          ;; The output of the ajax handler updates the `repl-output'\n          ;; page div.\n          target: \"repl-output\")\n\n    ;; Here's what is displayed to users\n    (++ (<h1> \"Sandboxed Chicken web REPL\")\n        (<input> type: \"text\" id: \"repl-input\")\n        (<div> id: \"repl-output\")))\n\n  ;; This tells `define-session-page' to link the page to JQuery\n  use-ajax: #t)") (p "To run the code above you'll need to install awful and sandbox:") (pre " $ chicken-install awful sandbox") (p "Then (considering you save the code above in a file called " (tt "web-sandbox.scm") "), run:") (pre " $ awful web-sandbox.scm") (p "and access " (tt "http://localhost:8080") ".") (p "Here are some screenshots of the code above running on Firefox:") (p (image-link "http://gazette.call-cc.org/img/10/web-sandbox.png")) (p "If you try something nasty, the sandbox will abort the evaluation and you'll get an error message and the call chain:") (p (image-link "http://gazette.call-cc.org/img/10/web-sandbox-loop.png")) (p "We can also compile the web application:") (pre "$ csc -s web-sandbox.scm\n$ awful web-sandbox.so")) (section 4 "Color chooser" (p "Here's an example provided by " (link "http://wiki.call-cc.org/users/christian-kellermann" "Christian Kellermann") " demonstrating an ajax-based color chooser:") (highlight scheme "(use awful html-utils html-tags)\n\n(define color-table\n  '(\"f63353\" \"fead76\" \"107279\" \"10fabc\" \"1181bf\" \"120902\" \"129105\"\n    \"131848\" \"13a04b\" \"1427ee\" \"14a8b1\" \"1532d4\" \"15bcf7\" \"16671a\"\n    \"16c13d\" \"175b60\" \"17d583\" \"186fa6\" \"18ecc9\" \"1973ec\"))\n\n(enable-ajax #t)\n\n(define (color-picker counter color)\n  (<div> class: \"color-box\" style: (conc  \"background-color: \" (conc \"#\" color))\n         (text-input (conc \"change-color-\" counter) value: color)))\n\n(define (make-color-chooser counter c)\n  (ajax \"ajax\" (conc \"#change-color-\" counter) 'change\n        (lambda ()\n          (let ((color (or ($ 'color) c))\n                (counter ($ 'counter)))\n            (color-picker counter color)))\n        target: (conc \"color-box-\" counter)\n        arguments: `((color . ,(conc  \"$('#change-color-\" counter \"').val()\"))\n                     (counter . ,counter))\n        live: #t)\n  (<div> id: (conc \"color-box-\" counter) (color-picker counter c)))\n\n(define-page (main-page-path)\n  (lambda ()\n    (concat (map (let ((counter -1))\n                   (lambda (c)\n                     (set! counter (add1 counter))\n                     (make-color-chooser counter c)))\n                 color-table))))\n") (p "Here's a screenshot:") (p (image-link "http://parenteses.org/mario/img/awful/color-chooser.png")) (p "To run this example (considering you save the code above in a file called " (tt "color-chooser.scm") "):") (pre " $ awful color-chooser.scm") (p "then access " (tt "http://localhost:8080") ".  You can change the colors by editing the input boxes then pressing enter.")) (section 4 "Fortune server" (p "This example is a fortune server in awful.  It demonstrates some handy awful features like database access and ajax.  You'll need the " (link "http://wiki.call-cc.org/egg/awful-sql-de-lite" "awful-sql-de-lite") " egg and its dependencies (which should be automatically installed by " (tt "chicken-install") ").") (p "Here are instructions to install and use it:") (p "1. Install " (link "http://wiki.call-cc.org/egg/awful-sql-de-lite" "awful-sql-de-lite")) (pre "  $ chicken-install awful-sql-de-lite") (p "2. Create the fortunes database (see the code below):") (pre "  $ csi -s create-database.scm") (p "3. Run the fortune server (see the code below):") (pre "  $ awful fortune-server.scm") (p "Here's the code for " (tt "create-database.scm") " which creates and populates the fortune database:") (highlight scheme "(use sql-de-lite posix)\n\n(define fortunes\n  '((\"Debugging is twice as hard as writing the code in the first place. Therefore, if you write the code as cleverly as possible, you are, by definition, not smart enough to debug it.\"\n     \"Brian Kernighan\")\n    (\"In order to understand recursion, one must first understand recursion.\")\n    (\"If debugging is the process of removing software bugs, then programming must be the process of putting them in.\"\n     \"Edsger Dijkstra\")\n    (\"Controlling complexity is the essence of computer programming.\"\n     \"Brian Kernigan\")\n    (\"The function of good software is to make the complex appear to be simple.\"\n     \"Grady Booch\")\n    (\"That's the thing about people who think they hate computers.  What they really hate is lousy programmers.\"\n     \"Larry Niven\")\n    (\"First learn computer science and all the theory.  Next develop a programming style.  Then forget all that and just hack.\"\n    \"George Carrette\")\n    (\"To iterate is human, to recurse divine.\"\n    \"L. Peter Deutsch\")\n    (\"The best thing about a boolean is even if you are wrong, you are only off by a bit.\")\n    (\"Optimism is an occupational hazard of programming; feedback is the treatment.\"\n     \"Kent Beck\")\n    (\"Simplicity is prerequisite for reliability.\"\n     \"Edsger W. Dijkstra\")\n    (\"Simplicity is the ultimate sophistication.\"\n     \"Leonardo da Vinci\")\n    (\"The unavoidable price of reliability is simplicity.\"\n     \"C.A.R. Hoare\")\n    (\"The ability to simplify means to eliminate the unnecessary so that the necessary may speak.\"\n     \"Hans Hoffmann\")\n    (\"Simplicity is hard to build, easy to use, and hard to charge for. Complexity is easy to build, hard to use, and easy to charge for.\"\n     \"Chris Sacca\")))\n\n(delete-file* \"fortunes.db\")\n\n(let ((db (open-database \"fortunes.db\")))\n  (exec (sql db \"create table fortunes(sentence text, author text)\"))\n  (for-each (lambda (fortune)\n              (let* ((sentence (car fortune))\n                     (author (cdr fortune))\n                     (statement\n                      (string-append\n                       \"insert into fortunes (sentence, author) values (?,?)\")))\n                (exec (sql db statement)\n                      sentence\n                      (if (null? author) \"\" (car author)))))\n            fortunes)\n  (close-database db))") (p "Here's the code for the fortune server:") (highlight scheme "(use awful html-tags awful-sql-de-lite)\n\n(enable-db)\n(db-credentials \"fortunes.db\")\n\n(define (random-fortune)\n  (car ($db \"select sentence, author from fortunes order by random() limit 1\")))\n\n(define-page (main-page-path)\n  (lambda ()\n    (ajax \"new-fortune\" 'new-fortune 'click\n          (lambda ()\n            (let ((fortune (random-fortune)))\n              `((sentence . ,(car fortune))\n                (author . ,(cadr fortune)))))\n          update-targets: #t)\n\n    (<div> id: \"content\"\n           (<div> id: \"sentence\" \"Click the button below to get a new fortune\")\n           (<div> id: \"author\")\n           (<button> id: \"new-fortune\" \"New fortune\")))\n\n  css: \"fortune.css\"\n  use-ajax: #t\n  charset: \"utf-8\")") (p "The contents of the " (tt "fortune.css") " file are:") (pre " body\n { font-family: arial, verdana, sans-serif;\n }\n \n #sentence\n { width: 20em;\n   background-color: #DEE7EC;\n   padding: 6px;\n   min-height: 7em;\n }\n \n #author\n { width: 20em;\n   min-height: 2em;\n   padding: 6px;\n   background-color: #eee;\n }") (p "Here's a screenshot:") (p (image-link "http://parenteses.org/mario/img/awful/fortune-server.png")))) (section 3 "The name" (p "Awful doesn't mean anything special.  It's just awful.  But folks on freenode's #chicken (IRC) have suggested some acronym expansions:") (ul (li "A Whole Freaking Universe of Lambdas") (li "Authored Without Full Understanding of Logic") (li "Another Web Framework Understating Logic") (li "All Worthless Frameworks Unchain Laziness") (li "Armed With Flimsy Utility Lisp") (li "Awful Will Fed Up Lispers") (li "Awful Wildly Finalizes Unfinished Loops") (li "Another Widely Foolish Unknown Language") (li "Ain't Work For Unpleasant Laywers") (li "Aliens Would Find it Utterly Lame") (li "Aren't We Funny and Uncaring Lurkers") (li "Awful Will F*** Up Logic") (li "Awful Will Fart Upon Leaving") (li "Again Web Frameworks Underscore Lameness") (li "Attention While Fully Utilizing Laziness") (li "Another Webserver F***ing Up the Line") (li "Again We Forget Unclosed Lambdas") (li "All Web Features Understood Losslessly") (li "Anything With Fully Universal Lambdas") (li "Again We Fail Under Load") (li "Apocalyptic Warthogs Find Undiscovered Lands") (li "Accessible Web Framework Using Lisp") (li "Another Weird Framework Using Lisp") (li "All Waffles Fear Unicorn Landings") (li "A Working Facility Underscoring Laziness") (li "Another Webbot Flapping Under Lines") (li "Anybody Will Fake Unrealistic Loveletters") (li "Armadillos Would First Use Legs") (li "Astonishing Whales Fill Up Lakes") (li "Alternative Way to F*** Up Lisp") (li "Another Way to Find Undressed Ladies") (li "Amazing! Wonderful! Fantastic! Unbelievable! Lame.") (li "All Wonders Feel Useless Later") (li "Amazingly Wonderful Feeling, Using Lambdas") (li "Alligators Will Fear Us, Lunatics") (li "All Wussies Fear Ultimate Lambda") (li "Animals Will Find Us Letal") (li "Advanced Web Framework: Ultimate Lucubration") (li "Awful Will Feed Urban Lethargy") (li "Argument With Focus Upon Labelling") (li "Another Word Faking Unpremeditated Label") (li "Again We Find it Utterly Useless") (li "Ain't Work For Unattractive Ladies") (li "A Way For Using Lambdas") (li "Awful Way For Using Lambdas") (li "Apparently We Freaks Understand Lambdas") (li "Again We Foolishly Use Lists") (li "At Work Fools Use Lisp") (li "Again We Foolishly Use Lisp") (li "Another Wimp Fall Upon Lisp") (li "Accepting Whatever Fools Undertake Lightly") (li "Absurd Word For Unnatural Lingo") (li "Alternative Word For Useless Loser") (li "Acronym With Filled Up Letters") (li "Acronym We Find Utterly Lame") (li "Another Webserver Functioning Until Launched") (li "Applications With Familiar, Understandable Language") (li "(Awful Words Forming Useless List)") (li "All Who Force Unusual Layout") (li "Again We Fear Undescribable Lamenting") (li "Awful Will Favour Ugly Layouts") (li "Apes With Frequent Uncontrolled Lunacy")) (section 4 "Acknowledgements (IRC nicknames on freenode's #chicken):" (ul (li "C-Keen") (li "DerGuteMoritz") (li "elderK") (li "elf") (li "florz") (li "merlincorey") (li "sjamaan")))) (section 3 "FAQ (aka Fakely Asked Questions)" (section 4 "How does awful bind URIs to files/directories on the filesystem and procedures?" (p "Explanation by example:") (p "When a procedure is bound to a path " (tt "a") " (like " (tt "(define-page \"a\" (lambda ...))") ") and the request is made to " (tt "a/") ", the awful behavior is the following:") (ul (li "if the path " (tt "a") " does not exist, the server replies with the result of the evaluation of the procedure bound to " (tt "a") ".") (li "if " (tt "a") " is an existent file, the server replies with the file contents (or the result of processing the file, in case it is a special one like " (int-link "/egg/spiffy#web-scheme-handler" "web-scheme") " or " (tt ".ssp") " files)") (li "if " (tt "a") " is an existing directory and the directory contains one of the files in " (tt "index-file") " (see documentation for " (int-link "/egg/spiffy" "Spiffy") "), with the index file contents (or the result of processing the file, in case it is a special one like " (int-link "/egg/spiffy#web-scheme-handler" "web-scheme") "'s or " (tt ".ssp") ")") (li "if " (tt "a") " is an existing directory and does not contain index files, the server replies with the result of the evaluation of the  procedure bound to " (tt "a") ".")))) (section 3 "Known bugs and limitations" (ul (li "The " (tt "ajax") " procedure is not session-aware when called from " (tt "define-session-page") " (it is when called from " (tt "define-page") ") and cookies are not enabled (i.e., " (tt "enable-session-cookie") " is " (tt "#f") ").  To workaround this bug, you can explicitly pass the sid (see the read-only " (tt "sid") " parameter) along with requests (see the " (tt "arguments") " keyword parameter for " (tt "ajax") " and ajax-related procedures).") (li "Awful currently doesn't detect if cookies are enabled on the client side.") (li "If you need to run awful as root to use privileged ports, beware that the given apps are loaded with root privileges, which are only dropped when Spiffy's " (tt "start-server") " starts running.") (li "If you are facing weird problems when reloading compiled applications (i.e., you have defined a page to reload your compiled applications), it is possible that a Chicken issue is the cause (see " (link "http://bugs.call-cc.org/ticket/442" "ticket #442") ")."))) (section 3 "License" (p "BSD")) (section 3 "Version history" (dl (dt "0.27") (dd "Require the " (tt "regex") " egg, for chickens >= 4.6.2") (dt "0.26")) (ul (li (tt "define-page") " allows page redefinitions") (li "Added the " (tt "undefine-page") " procedure") (li "Fancy web REPL (enabled by default).  The awful application server now accepts the " (tt "--disable-web-repl-fancy-editor") " command line option to disable the web REPL fancy editor.") (li "Added the following parameters, related to the fancy web REPL: " (tt "enable-web-repl-fancy-editor") " and " (tt "web-repl-fancy-editor-base-uri") ".") (li "Bug fix for the development mode: requests to the " (tt "/reload") " path killed " (tt "/web-repl") " and " (tt "/session-inspector"))) (dl (dt "0.25")) (ul (li "The awful application server can now be used with the " (tt "--development-mode") " command line option, which enables the web REPL, the session inspector (when " (tt "enable-session") " is #t) for the localhost and on-browser error messages and backtraces.  When running in development mode, the " (tt "/reload") " path is defined to reload awful apps.") (li "The awful application server now supports the " (tt "--ip-address") " and " (tt "--port") " command line options.") (li (tt "use-ajax") " keyword parameter for " (tt "define-page") " (for when " (tt "enable-ajax") " is " (tt "#f") " and you need ajax for some specific pages only)") (li "Added " (tt "awful-response-headers") " and " (tt "development-mode?") " parameters")) (dl (dt "0.24")) (ul (li "initial support for storing session identifiers in cookies.  Added the " (tt "enable-session-cookie") " and " (tt "session-cookie-name") " parameters.  By default, cookies-sessions are enabled (relevant only when using sessions, of course). " (b "Warning") ": if your code relies on the availability of session identifiers in the query string or in the request body for whatever reason, it will break.") (li "initial support for HTTP redirection via " (tt "redirect-to") ".") (li "web-repl and session-inspector beautification") (li "web-repl and session inspector provide a " (tt "headers") " keyword parameter") (li "fixes for " (tt "define-page") " regarding to regex-based paths") (li (tt "ajax") " always prioritizes the " (tt "success") " keyword parameter value (when it's given) to generate code for JQuery's " (tt "success") " attribute, even when " (tt "target") " and " (tt "update-targets") " are given") (li "awful (the application) handles the " (tt "-v") " and " (tt "--version") " command line options")) (dl (dt "0.23")) (ul (li "added the " (tt "update-targets") " keyword parameter for " (tt "ajax") ", " (tt "periodical-ajax") " and " (tt "ajax-link") " procedures (multiple targets update support)") (li "added the " (tt "debug-resources") " parameter for debugging the resources table") (li "the " (tt "js") " keyword parameter for " (tt "ajax") ", " (tt "periodical-ajax") " and " (tt "ajax-link") " has been renamed to " (tt "success") " (to match JQuery's API naming for Ajax). " (b "Warning") ": if your code uses the " (tt "js") " keyword parameter for " (tt "ajax") ", " (tt "periodical-ajax") " or " (tt "ajax-link") ", this change will break your code.") (li "the javascript variable bound to the response data on successful ajax request has been renamed to " (tt "response") " (it was " (tt "h") " before). The same warning for the " (tt "js") "->" (tt "success") " renaming is valid for this change, since it is directly related to " (tt "js") " (now " (tt "success") ").") (li "the default value for " (tt "main-page-path") " is now " (tt "\"/\"") " (it was " (tt "\"/main\"") " before).  There's no more main page redirection.  " (b "Warning") ": if your code relies on hardcoded " (tt "\"/main\"") " paths (instead of using " (tt "(main-page-path)") ") or if you rely on the main page automatic redirection, this change will break your code.") (li (tt "ajax") " bugfix regarding to session identifiers (could cause \"Invalid session ID\" errors in some cases, specially with " (tt "define-session-page") ").") (li "better handling of URI paths regarding to paths as directories (see FAQ's " (i "How does awful bind URIs to files/directories on the filesystem and procedures?") ")")) (dl (dt "0.22")) (ul (li "bug fix: fixed unintended shadowing of " (tt "js") " in ajax") (li "added the " (tt "prelude") " keyword parameter for " (tt "ajax") ", " (tt "periodical-ajax") " and " (tt "ajax-link")) (li (tt "$db") " supports the " (tt "values") " keyword parameter (patch by Stephen Eilert)") (li "awful (the application) can now be invoked without arguments") (li "awful (the application) handles " (tt "-h") " and " (tt "--help")) (li "dropped " (int-link "/eggref/4/jsmin" "jsmin") " requirement")) (dl (dt "0.21") (dd "ajax and main page redirection issues fixes") (dt "0.20")) (ul (li (tt "page-access-control") " controls access to pages even when no session is in use") (li (b "Warning") ": the following parameters have been removed: " (tt "enable-reload") ", " (tt "reload-path") " and " (tt "reload-message") ".  Now the way to define reloaders is via " (tt "define-page") ".") (li "new parameter: " (tt "awful-apps") " (a list of awful applications as passed to the awful server)")) (dl (dt "0.19") (dd "bug fix for " (tt "(reload-path)") " handler") (dt "0.18")) (ul (li "support for regex-based page paths (see " (tt "define-page") ")") (li (tt "define-page") " checks whether the second arg is a procedure.") (li "use " (tt "-O3 -lambda-lift") " instead of " (tt "-O2") " for compilation") (li (tt "main-page-path") " redirection made with code stolen from " (int-link "/egg/spiffy" "spiffy") "'s " (tt "send-response"))) (dl (dt "0.17") (dd ".meta bug fix.  postgresql is not required as a dependency (thanks to Stephen Pedrosa Eilert for pointing this issue).") (dt "0.16")) (ul (li "added " (tt "define-session-page")) (li "bug fix for " (tt "link"))) (dl (dt "0.15") (dd "jquery updated to 1.4.2 (" (tt "ajax-library") ").") (dt "0.14") (dd (tt "link") "'s " (tt "args") " keyword parameter renamed to " (tt "arguments") " (the same as " (tt "ajax") "'s).") (dt "0.13") (dd "Session-aware " (tt "link") " and " (tt "form") " procedures.  Bug fix for " (tt "ajax-link") " (was not passing the " (tt "class") " keyword argument to <a>).") (dt "0.12") (dd "Containers for user and password fields (" (tt "login-form") ")") (dt "0.11") (dd "awful sets Spiffy's " (tt "root-path") " to " (tt "(current-directory)")) (dt "0.10")) (ul (li "Multiple database support. Currently Postgresql (via " (int-link "/egg/postgresql" "postgresql") " egg) and Sqlite3 (via " (int-link "/egg/sqlite3" "sqlite3") " and " (int-link "/egg/sql-de-lite" "sql-de-lite") " eggs) are supported.  See " (int-link "/egg/awful-postgresql" "awful-postgresql") ", " (int-link "/egg/sqlite3" "sqlite3") " and " (int-link "/egg/sql-de-lite" "sql-de-lite") " eggs.") (li "Removed requirement for postgresql") (li (tt "enable-db") " is now a procedure (not a parameter as before) and accepts no arguments")) (dl (dt "0.9") (dd (tt "login-form") " gets the " (tt "user") " refilled when the session or passowrd is not valid.  This feature may be disabled by setting the " (tt "refill-user") " keyword parameter for " (tt "login-form") " to " (tt "#f") " (default is " (tt "#t") ").  Thanks to Arthur Maciel for suggesting this feature.") (dt "0.8")) (ul (li "jquery updated to 1.4.1 (" (tt "ajax-library") ").") (li "support for jquery's " (tt "live") " method (" (tt "live") " keyword parameter for " (tt "ajax") ", " (tt "ajax-link") " and " (tt "periodical-ajax") ").  See " (link "http://api.jquery.com/live/")) (li "bug fixes: " (tt "periodical-ajax") " and " (tt "ajax-link") " propagate " (tt "vhost-root-path") " to " (tt "ajax")) (li "added " (tt "awful-start") " and dropped spiffy requirement for awful (the server)") (li "dropped requirement for miscmacros") (li "added more ajax tests")) (dl (dt "0.7") (dd (tt "ajax-link") " accepts all " (tt "<a>") "'s keyword arguments") (dt "0.6") (dd "Explicitly depends on " (int-link "/egg/http-session" "http-session") " 2.0") (dt "0.5") (dd "Reload handler register the reload path after reloading.") (dt "0.4") (dd (tt "disable-reload?") " renamed to " (tt "enable-reload") ".  " (tt "enable-reload") " is " (tt "#f") " by default.") (dt "0.3") (dd (tt "awful") " (the server) allows applications to use Chicken syntax (" (tt "use") ", " (tt "include") " etc)") (dt "0.2") (dd "Added javascript compression support") (dt "0.1") (dd "Initial release")))))