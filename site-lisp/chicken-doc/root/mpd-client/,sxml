((tags "egg") (section 2 "mpd-client" (p "Interface to the " (link "http://www.musicpd.org/" "Music Player Daemon") ".") (toc)) (section 2 "Documentation" (p "This extension allows convenient access to the tcp interface of " (link "http://www.musicpd.org/" "MPD") ".") (section 3 "Connecting to MPD and obtaining connection/server information" (def (sig (procedure "(mpd:connect [HOST] [PORT] [PASSWORD])" (id mpd:connect))) (p "Connects to the MPD instance running on " (tt "HOST") " (defaults to " (tt "localhost") ") at " (tt "PORT") " (defaults to " (tt "6600") ").  Optionally authenticates using " (tt "PASSWORD") ". Returns an MPD connection object.")) (def (sig (procedure "(mpd:reconnect CONN)" (id mpd:reconnect))) (p "Reconnects the given MPD connection object.  This function should normally not be needed as the library automatically reconnects if needed.")) (def (sig (procedure "(mpd-conn? CONN)" (id mpd-conn?))) (p "Returns " (tt "#t") " if " (tt "CONN") " is an MPD connection object, " (tt "#f") " otherwise.")) (def (sig (procedure "(mpd:host CONN)" (id mpd:host))) (p "Returns the hostname field of the MPD connection object " (tt "CONN") ".")) (def (sig (procedure "(mpd:port CONN)" (id mpd:port))) (p "Returns the port field of the MPD connection object " (tt "CONN") ".")) (def (sig (procedure "(mpd:password CONN)" (id mpd:password))) (p "Returns the password field of the MPD connection object " (tt "CONN") ".  This is either a string containing the plain text password or " (tt "#f") " if no authentication should be done.")) (def (sig (procedure "(mpd:version CONN)" (id mpd:version))) (p "Returns the version field of the MPD connection object " (tt "CONN") " which contains the version number received by the MPD server.")) (def (sig (procedure "(mpd:close CONN)" (id mpd:close))) (p "Closes the connection to MPD.  " (tt "CONN") " should not be used anymore after calling this function.")) (def (sig (procedure "(mpd:ping CONN)" (id mpd:ping))) (p "Sends a " (tt "ping") " command to the MPD server, reconnecting if necessary.")) (def (sig (procedure "(mpd:clear-error CONN)" (id mpd:clear-error))) (p "Clears the current error message (which is returned by " (tt "(mpd:status)") "). This is also done by any command that starts playback.")) (def (sig (procedure "(mpd:stats CONN)" (id mpd:stats))) (p "Returns an alist containing various stats:") (pre "#;6> (pp (mpd:stats m))\n((artists . 183)\n (albums . 429)\n (songs . 6200)\n (uptime . 130260)\n (playtime . 49958)\n (db_playtime . 1773229)\n (db_update . 1152376960.0))\n#;7>")) (def (sig (procedure "(mpd:status CONN)" (id mpd:status))) (p "Return an alist describing the current status of MPD:") (pre "#;9> (pp (mpd:status m))\n((volume . 78)\n (repeat . #f)\n (random . #f)\n (playlist . 78)\n (playlistlength . 77)\n (xfade . 0)\n (state . play)\n (song . 12)\n (songid . 12)\n (time 31 623)\n (bitrate . 128)\n (audio 44100 16 2))\n#;10>")) (def (sig (procedure "(mpd:kill CONN)" (id mpd:kill))) (p "Kill MPD.")) (def (sig (procedure "(mpd:send-password CONN PASSWORD)" (id mpd:send-password))) (p "Sends " (tt "PASSWORD") " (a string containing the plain text password) to the server for authentication.  Normally, this not needed as the password can be specified when creating the connection which has the advantage that it's automatically sent after having reconnected.")) (def (sig (procedure "(mpd:commands CONN)" (id mpd:commands))) (p "Returns a list of commands the current user has access to.")) (def (sig (procedure "(mpd:not-commands CONN)" (id mpd:not-commands))) (p "Returns a list of commands the current user doesn't have access to."))) (section 3 "Controlling playback" (def (sig (procedure "(mpd:play/pos CONN POS)" (id mpd:play/pos))) (p "Start playing at position " (tt "POS") ".")) (def (sig (procedure "(mpd:play/id CONN ID)" (id mpd:play/id))) (p "Start playing at song with id " (tt "ID") ".")) (def (sig (procedure "(mpd:seek/pos CONN POS SECS)" (id mpd:seek/pos))) (p "Seeks to " (tt "SECS") " in the song at position " (tt "POSITION") ".")) (def (sig (procedure "(mpd:seek/id CONN ID SECS)" (id mpd:seek/id))) (p "Seeks to " (tt "SECS") " in the song with id " (tt "ID") ".")) (def (sig (procedure "(mpd:next CONN)" (id mpd:next))) (p "Play the next song in the playlist.")) (def (sig (procedure "(mpd:previous CONN)" (id mpd:previous))) (p "Play the previous song in the playlist.")) (def (sig (procedure "(mpd:stop CONN)" (id mpd:stop))) (p "Stop playback.")) (def (sig (procedure "(mpd:pause CONN PAUSE?)" (id mpd:pause))) (p "Pause if " (tt "PAUSE?") " is true, resume playing otherwise.")) (def (sig (procedure "(mpd:random CONN RANDOM?)" (id mpd:random))) (p "Enable or disable random.")) (def (sig (procedure "(mpd:repeat CONN REPEAT?)" (id mpd:repeat))) (p "Enable or disable repeat.")) (def (sig (procedure "(mpd:crossfade CONN SECS)" (id mpd:crossfade))) (p "Sets the cross fading setting to " (tt "SECS") " seconds (0 = disabled).")) (def (sig (procedure "(mpd:set-vol CONN VOLUME)" (id mpd:set-vol))) (p "Sets the volume to " (tt "VOLUME") " (a fixnum in the range 0-100)."))) (section 3 "Managing output devices" (def (sig (procedure "(mpd:outputs CONN)" (id mpd:outputs))) (p "Returns a list of alists describing the available output devices.")) (def (sig (procedure "(mpd:enable-output CONN ID)" (id mpd:enable-output))) (p "Enables the output device with id " (tt "ID") ".")) (def (sig (procedure "(mpd:disable-output CONN ID)" (id mpd:disable-output))) (p "Disables the output device with id " (tt "ID") "."))) (section 3 "Querying and modifying the current playlist" (def (sig (procedure "(mpd:playlist/pos CONN [POS])" (id mpd:playlist/pos))) (p "Return a list of alists describing the songs in the current playlist. (Optionally only the song at position " (tt "POS") ").  See below for an example of the result format.")) (def (sig (procedure "(mpd:playlist/id CONN [ID])" (id mpd:playlist/id))) (p "Return a list of alists describing the songs in the current playlist. (Optionally only the song with id " (tt "ID") "):") (pre "#;10>  (pp (mpd:playlist/id m 12))\n(((Id . 12)\n  (Pos . 12)\n  (Time . 623)\n  (Title . \"the leper affinity\")\n  (Track . 1)\n  (Album . \"blackwater park\")\n  (Artist . \"opeth\")\n  (file . \"metal/opeth/blackwater park/01 the leper affinity.mp3\")))\n#;11>")) (def (sig (procedure "(mpd:current-song CONN)" (id mpd:current-song))) (p "Returns an alist with information about the current song (the same information that " (tt "(mpd:playlist/id)") " returns).")) (def (sig (procedure "(mpd:pl-changes CONN VERSION)" (id mpd:pl-changes))) (p "Return a list of alists describing new songs since playlist version " (tt "VERSION") ". Note: to detect songs that were deleted at the end of the playlist, use the " (tt "playlistlength") " returned by " (tt "(mpd:status)") ".")) (def (sig (procedure "(mpd:pl-changes/pos+id CONN VERSION)" (id mpd:pl-changes/pos+id))) (p "Similar to " (tt "mpd:pl-changes") " but only returns the position and id of each song.")) (def (sig (procedure "(mpd:add CONN PATH)" (id mpd:add))) (p "Adds " (tt "PATH") " (a string naming a file or directory) to the end of the current playlist.  Directories are added recursively.  Increments playlist version by 1 for each added song.")) (def (sig (procedure "(mpd:add/id CONN PATH)" (id mpd:add/id))) (p "Similar to " (tt "mpd:add") " but returns a list of ids of the newly added songs.")) (def (sig (procedure "(mpd:move/pos CONN FROM TO)" (id mpd:move/pos))) (p "Move song at position " (tt "FROM") " to " (tt "TO") ".  The playlist version is incremented by 1.")) (def (sig (procedure "(mpd:move/id CONN ID TO)" (id mpd:move/id))) (p "Move song with id " (tt "ID") " to " (tt "TO") ".  The playlist version is incremented by 1.")) (def (sig (procedure "(mpd:swap/pos CONN POS1 POS2)" (id mpd:swap/pos))) (p "Swap position of the two songs given by playlist positions " (tt "POS1") " and " (tt "POS2") ".")) (def (sig (procedure "(mpd:swap/id CONN ID1 ID2)" (id mpd:swap/id))) (p "Swap position of the two songs given by ids " (tt "ID1") " and " (tt "ID2") ".")) (def (sig (procedure "(mpd:delete/pos CONN POS)" (id mpd:delete/pos))) (p "Remove the song at position " (tt "POS") " from playlist.  The playlist version is incremented by 1.")) (def (sig (procedure "(mpd:delete/id CONN ID)" (id mpd:delete/id))) (p "Remove the song with id " (tt "ID") " from playlist.  The playlist version is incremented by 1.")) (def (sig (procedure "(mpd:shuffle CONN)" (id mpd:shuffle))) (p "Shuffles the current playlist and increments the playlist version by 1.")) (def (sig (procedure "(mpd:clear CONN)" (id mpd:clear))) (p "Clears the current playlist, incrementing playlist version by 1."))) (section 3 "Managing stored playlist" (def (sig (procedure "(mpd:load-playlist CONN PLAYLIST)" (id mpd:load-playlist))) (p "Loads the playlist named " (tt "\"PLAYLIST.m3u\"") " from the playlist directory. The playlist version is incremented by the number of songs added.")) (def (sig (procedure "(mpd:rm-playlist CONN PLAYLIST)" (id mpd:rm-playlist))) (p "Removes the playlist named " (tt "\"PLAYLIST.m3u\"") " from the playlist directory.")) (def (sig (procedure "(mpd:save-playlist CONN PLAYLIST)" (id mpd:save-playlist))) (p "Saves the current playlist to " (tt "\"PLAYLIST.m3u\"") " in the playlist directory."))) (section 3 "Querying/Updating song database" (def (sig (procedure "(mpd:find CONN TYPE STRING)" (id mpd:find))) (p "Searches for songs and returns a list of alists.  " (tt "TYPE") " is e.g. " (tt "'title") ", " (tt "'album") " or " (tt "'artist") ".  " (tt "STRING") " is the search string (which must match exactly).")) (def (sig (procedure "(mpd:find/album CONN ALBUM)" (id mpd:find/album))) (p "Returns a list of alists describing songs on album " (tt "ALBUM") " (a string).") (pre "#;13> (pp (mpd:find/album m \"catch 33\"))\n(((Time . 101)\n  (Title . \"autonomy lost\")\n  (Track . 1)\n  (Album . \"catch 33\")\n  (Artist . \"meshuggah\")\n  (file . \"metal/meshuggah/catch 33/01 autonomy lost.mp3\"))\n ((Time . 96)\n  (Title . \"imprint of the un-saved\")\n  (Track . 2)\n  (Album . \"catch 33\")\n  (Artist . \"meshuggah\")\n  (file . \"metal/meshuggah/catch 33/02 imprint of the un-saved.mp3\"))\n...\n#;14>")) (def (sig (procedure "(mpd:find/artist CONN ARTIST)" (id mpd:find/artist))) (p "Returns a list of alists describing songs from " (tt "ARTIST") " (a string).")) (def (sig (procedure "(mpd:find/title CONN TITLE)" (id mpd:find/title))) (p "Returns a list of alists describing songs with title " (tt "TITLE") " (a string).")) (def (sig (procedure "(mpd:search CONN TYPE SEARCHSTRING)" (id mpd:search))) (p "Returns a list of alists describing the matching songs.  " (tt "TYPE") " is e.g. " (tt "'title") ", " (tt "'album") " or " (tt "'artist") ".  " (tt "SEARCHSTRING") " is the string which is searched for (not case sensitive, doesn't need to be an exact match).")) (def (sig (procedure "(mpd:search/album CONN SEARCHSTRING)" (id mpd:search/album))) (p "Returns a list of alists describing songs whose album names contain " (tt "SEARCHSTRING") " (not case sensitive).")) (def (sig (procedure "(mpd:search/artist CONN SEARCHSTRING)" (id mpd:search/artist))) (p "Returns a list of alists describing songs whose artist names contain " (tt "SEARCHSTRING") " (not case sensitive).")) (def (sig (procedure "(mpd:search/title CONN SEARCHSTRING)" (id mpd:search/title))) (p "Returns a list of alists describing songs whose titles contain " (tt "SEARCHSTRING") " (not case sensitive).")) (def (sig (procedure "(mpd:search/filename CONN SEARCHSTRING)" (id mpd:search/filename))) (p "Returns a list of alists describing songs whose filenames contain " (tt "SEARCHSTRING") " (not case sensitive).")) (def (sig (procedure "(mpd:list CONN TYPE [LIMIT STRING])" (id mpd:list))) (p "Return a list of values of metadata " (tt "TYPE") " (e.g. " (tt "'title") ", " (tt "'album") " or " (tt "'artist") "), optionally limited by " (tt "LIMIT") " and " (tt "STRING") ". E.g. " (tt "(mpd:list m 'album 'artist \"nevermore\")") " to get a list of all albums by Nevermore.")) (def (sig (procedure "(mpd:list-artists CONN)" (id mpd:list-artists))) (p "Returns a list of all known artists.")) (def (sig (procedure "(mpd:list-albums CONN [ARTIST])" (id mpd:list-albums))) (p "Returns a list of all known albums, optionally limited by " (tt "ARTIST") ".")) (def (sig (procedure "(mpd:list-all CONN [PATH])" (id mpd:list-all))) (p "Returns a list of filenames of all songs (below " (tt "PATH") ", if given).")) (def (sig (procedure "(mpd:list-all/info CONN [PATH])" (id mpd:list-all/info))) (p "Like " (tt "(mpd:list-all)") ", but also returns metadata.  The data is returned as a list of alists.")) (def (sig (procedure "(mpd:ls/info CONN [DIR])" (id mpd:ls/info))) (p "Returns a list of alists describing the contents of " (tt "DIR") " (a string). This function is like " (tt "(mpd:list-all/info)") ", but doesn't operate recursively.")) (def (sig (procedure "(mpd:update CONN [PATH])" (id mpd:update))) (p "Updates MPD's database, removing old songs and adding new songs.  Optionally, the update process can be limited to " (tt "PATH") " (a string naming a file or directory).")))) (section 2 "Examples" (pre "#!/usr/local/bin/csi -script\n\n(require-extension mpd-client srfi-18 utils)\n\n(define mpd (mpd:connect))\n\n(define (get-mpd-status)\n  (let ((status (mpd:status mpd)))\n    (list (alist-ref 'songid status)\n          (alist-ref 'state status))))\n\n(define (get-songname id)\n  (let ((info (car (mpd:playlist/id mpd id))))\n    (or (alist-ref 'Title info)\n        (pathname-strip-directory\n         (alist-ref 'file info)))))\n\n(let loop ((status (get-mpd-status)) (old-status #f))\n  (unless (equal? status old-status)\n    (let ((song (car status))\n          (state (cadr status)))\n      (cond\n       ((eq? state 'play)\n        (printf \"Now playing: ~a\\n\"\n                (if song\n                    (get-songname song)\n                    \"(unknown song)\")))\n\n       ((eq? state 'stop)\n        (printf \"STOP\\n\")))))\n  (thread-sleep! 1)\n  (loop (get-mpd-status) status))")) (section 2 "About this egg" (section 3 "Author" (p (link "http://www.nil.at/" "Hans Bulfone"))) (section 3 "Version history" (dl (dt "1.12") (dd "Added regex as a dependency; converted eggdoc documentation to wiki format [Ivan Raikov]") (dt "1.1") (dd "Added new commands supported by recent versions of MPD") (dt "1.02") (dd "Fixed a bug that caused playlists to be returned incorrectly by " (tt "mpd:ls/info") " et al.") (dt "1.01") (dd "Fixed typo in documentation") (dt "1.0") (dd "Initial release"))) (section 3 "License" (pre "Copyright (c) 2006-2007, Hans Bulfone\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n    * Redistributions of source code must retain the above copyright notice,\n      this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above copyright\n      notice, this list of conditions and the following disclaimer in the\n      documentation and/or other materials provided with the distribution.\n    * Neither the name of the author nor the names of his contributors may\n      be used to endorse or promote products derived from this software\n      without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\nTHE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\nPURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR\nCONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\nEXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\nPROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;\nOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\nWHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR\nOTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF\nADVISED OF THE POSSIBILITY OF SUCH DAMAGE."))))