((tags "egg") (section 2 "fastcgi" (toc) (section 3 "Description" (p "Bindings for the FCGX API of libfcgi.")) (section 3 "Author" (p (int-link "mailto:a.drummond@ucl.ac.uk" "Alex Drummond")) (section 4 "Usage" (pre " (use fastcgi)"))) (section 3 "Documentation" (p "This egg provides a high-level interface to the FCGX API of libfcgi, part of the " (link "http://www.fastcgi.com/devkit/doc/overview.html" "FastCGI Devkit") ".") (section 4 "fcgi-accept-loop" (def (sig (procedure "(fcgi-accept-loop SOCKET/PORT BACKLOG CALLBACK)" (id fcgi-accept-loop))) (p "Given either the filename of a UNIX local socket (string) or a port (integer) as its first argument, this procedure opens a socket and starts a loop for accepting FastCGI requests.  An exception is raised if there is an error opening/listening on the socket.  Every time a request is accepted, the CALLBACK argument is called with four procedure arguments which will be refered to as 'in', 'out', 'err' and 'env' in the documentation below.  The BACKLOG argument is passed to the " (link "http://www.die.net/doc/linux/man/man3/listen.3.html" "listen") " system call.") (p "If the callback returns " (tt "#f") ", the accept loop is terminated.")) (section 5 "in" (def (sig (procedure "(in [INT])" (id in))) (p "[This procedure is passed to the CALLBACK argument of " (tt "fcgi-accept-loop") ".]") (p "If called with no arguments, this procedure reads in as much data as possible from the input stream, returning " (tt "#f") " if the stream is empty, and a string otherwise.  If called with a single integer argument, it reads exactly the specified number of characters from the stream (and will block indefinitely if the stream is empty or contains too few characters).") (p "In either case, an exception is raised if there is an error reading from the stream.") (p "Don't use " (tt "(in)") " to read in post data, since there is no guarantee that it will read all of it.  Instead, call " (tt "in") " with the value of the " (tt "HTTP_CONTENT_LENGTH") " environment variable, or use the " (tt "fcgi-get-post-data") " procedure.") (p "The variable " (tt "*fcgi-slurp-chunk-size*") " determines the size of the input buffer which will be allocated by a zero-argument call to " (tt "in") ".  The value of this variable does not affect the maximum amount of input which can be read in, since additional buffers are automatically allocated as necessary."))) (section 5 "out" (def (sig (procedure "(out STRING)" (id out))) (p "[This procedure is passed to the " (tt "CALLBACK") " argument of " (tt "fcgi-accept-loop") ".]") (p "Writes " (tt "STRING") " to the output stream, raising an exception if there is an error."))) (section 5 "err" (def (sig (procedure "(err STRING)" (id err))) (p "[This procedure is passed to the " (tt "CALLBACK") " argument of " (tt "fcgi-accept-loop") ".]") (p "Writes " (tt "STRING") " to the error stream, raising an exception if there is an error."))) (section 5 "env" (def (sig (procedure "(env [VARNAME [DEFAULT]])" (id env))) (p "[This procedure is passed to the " (tt "CALLBACK") " argument of " (tt "fcgi-accept-loop") ".]") (p "If called with no arguments, this procedure returns a list of " (tt "(name . value)") " pairs giving the name and value of every variable in the environment.  If called with a single argument " (tt "VARNAME") ", it returns the value of the specified variable, or " (tt "#f") "if that variable is not set.") (p (tt "VARNAME") " may optionally be followed by a second argument, which specifies a default value to be returned if the variable is not set. " (tt "(env X)") " is thus equivalent to " (tt "(env X #f)") ".") (p "Note that this procedure cannot be called after another request has been accepted, since libfcgi does not maintain environments from previous requests (you will most likely get a segfault).  However, an old environment can easily be saved if necessary by storing the return value of " (tt "(env)") ".")))) (section 4 "fcgi-get-post-data" (def (sig (procedure "(fcgi-get-post-data IN ENV)" (id fcgi-get-post-data))) (p "Given an " (tt "IN") " procedure and an " (tt "ENV") " procedure, this procedure returns a string containing the post data for the last request, or " (tt "#f") " if the last request was not a post request.")))) (section 3 "Example" (p "A file named " (tt "example.scm") " is included in the egg.")) (section 3 "Changelog" (ul (li "1.1 Port to Chicken 4") (li "1.0.1 Bug fix (thanks to Maria Rekouts)") (li "1.0 First version"))) (section 3 "License" (pre " Copyright (c) 2006, Alex Drummond <a.d.drummond@googlemail.com>,\n with contributions from Maria Rekouts, Nikolay Zavaritsky and\n Joachim Schipper. All rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions\n are met:\n \n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n    * The name of the author(s) may not be used to endorse or promote\n      products derived from this software without specific prior\n      written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS\n FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE\n COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\n INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,\n BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\n LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\n ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n POSSIBILITY OF SUCH DAMAGE."))))